<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://cdnjs.cloudflare.com 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; connect-src 'self' data: blob: http://127.0.0.1:* https://127.0.0.1:* ws://127.0.0.1:*;">
    <title>ğŸ¨ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆåˆ†é¡ãƒ„ãƒ¼ãƒ« v3.0</title>
    <link rel="stylesheet" href="set-modal.css">
    <link rel="stylesheet" href="story-builder.css">
    <link rel="stylesheet" href="yaml_generator_system/yaml-generator.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 0;
            overflow-x: hidden;
        }

        .container {
            display: flex;
            align-items: flex-start;
            min-height: 100vh;
            background: #f8f9fa;
        }

        /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ */
        .sidebar {
            width: 280px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            overflow-y: auto;
        }

        .sidebar h3 {
            color: white;
            margin-bottom: 20px;
            font-size: 1.3em;
            text-align: center;
        }

        .sidebar-section {
            margin-bottom: 25px;
        }

        .sidebar-section h4 {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9em;
            margin-bottom: 12px;
            padding: 8px 10px;  /* âœ… UIæ”¹å–„: paddingèª¿æ•´ */
            cursor: pointer;  /* âœ… UIæ”¹å–„: ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã«ã™ã‚‹ */
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-radius: 6px;
            transition: all 0.3s;
        }

        .sidebar-section h4:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* âœ… UIæ”¹å–„: æŠ˜ã‚ŠãŸãŸã¿ã‚¢ã‚¤ã‚³ãƒ³ */
        .sidebar-section h4::after {
            content: 'â–¼';
            font-size: 0.8em;
            transition: transform 0.3s;
        }

        .sidebar-section.collapsed h4::after {
            transform: rotate(-90deg);  /* æŠ˜ã‚ŠãŸãŸã¿æ™‚ã¯å³å‘ã */
        }

        /* âœ… UIæ”¹å–„: æŠ˜ã‚ŠãŸãŸã¿å¯èƒ½ãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
        .sidebar-section-content {
            max-height: 1000px;  /* ååˆ†ãªé«˜ã• */
            overflow: hidden;
            transition: max-height 0.3s ease-out, opacity 0.3s;
            opacity: 1;
        }

        .sidebar-section.collapsed .sidebar-section-content {
            max-height: 0;
            opacity: 0;
        }

        .sidebar-btn {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.95em;
            font-weight: 500;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sidebar-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateX(5px);
        }

        /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
        .main-content {
            flex: 1;
            min-width: 0;
            padding: 30px;
            overflow: visible;
        }

        .header {
            background: white;
            padding: 25px 30px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }

        .header h1 {
            font-size: 1.8em;
            color: #333;
            margin-bottom: 8px;
        }

        .header p {
            color: #666;
            font-size: 0.95em;
        }

        /* ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³ */
        .drop-zone {
            background: white;
            padding: 60px;
            border: 3px dashed #667eea;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 25px;
        }

        .drop-zone.dragover {
            background: #f8f9ff;
            border-color: #764ba2;
            transform: scale(1.02);
        }

        .drop-zone-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .drop-zone-text {
            font-size: 1.2em;
            color: #667eea;
            font-weight: bold;
        }

        /* çµæœã‚»ã‚¯ã‚·ãƒ§ãƒ³ - ğŸ”¥ Phase 7.7: å¸¸æ™‚è¡¨ç¤º */
        .results-section {
            display: block;    /* none â†’ block ã«å¤‰æ›´ */
        }

        .raw-prompt-box {
            background: white;
            border: 2px solid #667eea;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .raw-prompt-box h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .prompt-text {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.6;
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 12px;
        }

        /* ã‚«ãƒ†ã‚´ãƒªã‚°ãƒªãƒƒãƒ‰ */
        .categories-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);  /* âœ… UIæ”¹å–„: 4åˆ—ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ - ã•ã‚‰ã«ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆåŒ– */
            gap: 15px;  /* âœ… ç¸®å°: 20px â†’ 15px */
            margin-bottom: 20px;  /* âœ… ç¸®å°: 25px â†’ 20px */
        }

        .category-box {
            background: white;
            border-radius: 10px;  /* âœ… ç¸®å°: 12px â†’ 10px */
            padding: 14px;  /* âœ… ç¸®å°: 20px â†’ 14px */
            box-shadow: 0 2px 6px rgba(0,0,0,0.06);  /* âœ… è»½é‡åŒ– */
            transition: all 0.3s;
        }

        .category-box:hover {
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 2px solid #f0f0f0;
        }

        .category-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .category-icon {
            font-size: 1.4em;  /* âœ… ç¸®å°: 1.8em â†’ 1.4em */
        }

        .category-title {
            font-size: 0.9em;  /* âœ… ç¸®å°: 1.1em â†’ 0.9em */
            font-weight: bold;
            color: #333;
        }

        .category-count {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .category-actions {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .category-action-btn {
            flex: 1;
            min-width: 70px;  /* âœ… ç¸®å°: 80px â†’ 70px */
            padding: 6px 10px;  /* âœ… ç¸®å°: 8px 12px â†’ 6px 10px */
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #495057;
            border: 1px solid #dee2e6;
            border-radius: 5px;  /* âœ… ç¸®å°: 6px â†’ 5px */
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.75em;  /* âœ… ç¸®å°: 0.85em â†’ 0.75em */
            font-weight: 500;
        }

        .category-action-btn:hover {
            background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        .tag-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            min-height: 50px;
        }

        .tag {
            background: #f8f9ff;
            border: 1px solid #667eea;
            border-radius: 6px;
            padding: 5px 10px;      /* ğŸ”¥ Phase 7.6: ç¸®å° (8px 14px â†’ 5px 10px) */
            font-size: 0.75em;      /* ğŸ”¥ Phase 7.6: ç¸®å° (0.95em â†’ 0.75em) */
            color: #764ba2;
            transition: all 0.2s;
        }

        .tag:hover {
            background: #e8e9ff;
            transform: scale(1.05);
        }

        /* ãƒœã‚¿ãƒ³ã‚°ãƒ«ãƒ¼ãƒ— */
        .button-group {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {

        /* Modal overlay */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.45);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            padding: 16px;
        }

        .modal .modal-content {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-width: 95vw;
            width: 95vw;
            max-height: 90vh;
            overflow: hidden;
        }

        /* Modal overlay */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.45);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            padding: 16px;
        }

        .modal .modal-content {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-width: 95vw;
            width: 95vw;
            max-height: 90vh;
            overflow: hidden;
        }
            background: #5a6268;
            transform: translateY(-2px);
        }

        /* ğŸ­ Phase 6: ADDCOLè¤‡æ•°ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å¯¾å¿œCSS */
        /* ç·‘ãƒãƒƒã‚¸ï¼šå˜ä¸€ãƒ¢ãƒ¼ãƒ‰è¡¨ç¤º */
        .single-mode-badge {
            background: linear-gradient(135deg, #52c41a 0%, #389e0d 100%);
            color: white;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
            margin-left: 8px;
            font-weight: 600;
        }

        /* 2äººãƒ¢ãƒ¼ãƒ‰é¸æŠãƒœã‚¿ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ */
        .dual-char-select-btns {
            display: none;
            gap: 10px;
            margin-top: 8px;
            margin-bottom: 12px;
        }

        /* ã‚­ãƒ£ãƒ©1é¸æŠãƒœã‚¿ãƒ³ï¼ˆé’ï¼‰ */
        .char1-select-btn {
            flex: 1;
            background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .char1-select-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(74, 144, 226, 0.3);
        }

        /* ã‚­ãƒ£ãƒ©2é¸æŠãƒœã‚¿ãƒ³ï¼ˆç·‘ï¼‰ */
        .char2-select-btn {
            flex: 1;
            background: linear-gradient(135deg, #52c41a 0%, #389e0d 100%);
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .char2-select-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(82, 196, 26, 0.3);
        }

        /* ğŸ”¥ Phase 7: æ¨ªåˆ†å‰²ã‚³ãƒ³ãƒ†ãƒŠï¼ˆé©æ–°çš„ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰ */
        .dual-char-tags {
            display: none;
            margin-top: 12px;
        }

        /* æ¨ªåˆ†å‰²ã‚³ãƒ³ãƒ†ãƒŠ */
        .dual-char-horizontal-container {
            display: flex;
            flex-direction: row;
            min-height: 120px;
            max-height: 400px;     /* ğŸ”¥ Phase 7.6: æ‹¡å¤§ (350px â†’ 400px) */
            gap: 0;
            margin-top: 8px;
        }

        /* å„ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åŠåˆ†ã‚¨ãƒªã‚¢ */
        .char-half {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        /* ã‚­ãƒ£ãƒ©1ã‚¨ãƒªã‚¢ï¼ˆé’ãƒ»å·¦å´ï¼‰ */
        .char1-area {
            border-left: 4px solid #4a90e2;
            background: linear-gradient(to right, rgba(74, 144, 226, 0.05) 0%, transparent 100%);
            box-shadow: inset 4px 0 8px rgba(74, 144, 226, 0.1);
        }

        /* ã‚­ãƒ£ãƒ©2ã‚¨ãƒªã‚¢ï¼ˆã‚ªãƒ¬ãƒ³ã‚¸ãƒ»å³å´ï¼‰ */
        .char2-area {
            border-right: 4px solid #ff9800;
            background: linear-gradient(to left, rgba(255, 152, 0, 0.05) 0%, transparent 100%);
            box-shadow: inset -4px 0 8px rgba(255, 152, 0, 0.1);
        }

        /* ä¸­å¤®åˆ†å‰²ç·šï¼ˆã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ */
        .category-divider {
            width: 3px;
            background: linear-gradient(to bottom, #4a90e2 0%, #9e9e9e 50%, #ff9800 100%);
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.15);
            flex-shrink: 0;
        }

        /* ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ©ãƒ™ãƒ«ï¼ˆæ”¹è‰¯ç‰ˆï¼‰ */
        .char-label {
            font-weight: bold;
            font-size: 14px;
            color: #333;
            margin-bottom: 8px;
            padding-bottom: 6px;
            border-bottom: 1px solid #e0e0e0;
        }

        /* ã‚¿ã‚°ã‚³ãƒ³ãƒ†ãƒŠï¼ˆæ¨ªåˆ†å‰²ç”¨ï¼‰ */
        .char1-tags, .char2-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        /* ã‚¿ã‚°ã®ã‚«ãƒ¼ãƒ‰æ·±åº¦åŠ¹æœ */
        .char1-tags .tag {
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
            transition: all 0.25s ease;
        }

        .char1-tags .tag:hover {
            border-color: #4a90e2;
            box-shadow: 0 4px 12px rgba(74, 144, 226, 0.25);
            transform: translateY(-2px);
        }

        .char2-tags .tag {
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
            transition: all 0.25s ease;
        }

        .char2-tags .tag:hover {
            border-color: #ff9800;
            box-shadow: 0 4px 12px rgba(255, 152, 0, 0.25);
            transform: translateY(-2px);
        }

        /* æ—§CSSï¼ˆå¾Œæ–¹äº’æ›æ€§ã®ãŸã‚æ®‹ã™ï¼‰ */
        .char1-tags-area, .char2-tags-area {
            display: none;
        }

        /* ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ©ãƒ™ãƒ« */
        .char-label {
            font-weight: bold;
            margin-right: 8px;
            font-size: 14px;
            color: #333;
        }

        /* æœªé¸æŠã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ */
        .char-status {
            color: #999;
            font-size: 14px;
        }

        /* å˜ä¸€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆãƒœã‚¿ãƒ³ï¼ˆé’ï¼‰ */
        .generate-btn-single {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
        }

        .generate-btn-single:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        /* 2äººçµ±åˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆãƒœã‚¿ãƒ³ï¼ˆç´«ï¼‰ */
        .generate-btn-dual {
            background: linear-gradient(135deg, #a855f7 0%, #7c3aed 100%);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
        }

        .generate-btn-dual:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(168, 85, 247, 0.4);
        }

        /* ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå‡ºåŠ›ãƒœã‚¿ãƒ³ï¼ˆç·‘ï¼‰ */
        .output-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
        }

        .output-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.4);
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
        @media (max-width: 1024px) {
            .container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
            }

            .categories-grid {
                grid-template-columns: 1fr;
            }
        }

        /* ã‚»ãƒƒãƒˆé¸æŠãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆPhase15ï¼‰: è©³ç´°ã‚¹ã‚¿ã‚¤ãƒ«ã¯ set-modal.css ã«ç§»å‹• */

        /* ã‚»ãƒƒãƒˆç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« / ç”»åƒç™»éŒ²ãƒ¢ãƒ¼ãƒ€ãƒ«: è©³ç´°ã‚¹ã‚¿ã‚¤ãƒ«ã¯ set-modal.css ã«ç§»å‹• */

    </style>
</head>
<body>
    <div class="container">
        <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
        <div class="sidebar">
            <h3>ğŸ¨ ç®¡ç†ãƒ‘ãƒãƒ«</h3>

            <div class="sidebar-section">
                <h4>ğŸ“ åŸºæœ¬æ“ä½œ</h4>
                <div class="sidebar-section-content">
                    <button class="sidebar-btn" id="clearAllBtn">
                        <span>ğŸ—‘ï¸</span> å…¨å‰Šé™¤
                    </button>
                    <button class="sidebar-btn" id="yamlGenerateBtn">
                        <span>ğŸ“„</span> YAMLç”Ÿæˆ
                    </button>
                    <button class="sidebar-btn" id="storyPromptBtn">
                        <span>ğŸ“–</span> ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
                    </button>
                </div>
            </div>

            <div class="sidebar-section collapsed">
                <h4>ğŸ”„ è¾æ›¸ç®¡ç†</h4>
                <div class="sidebar-section-content">
                    <div style="display:flex; gap:8px; align-items:stretch;">
                        <button class="sidebar-btn" id="updateDictionaryBtn" style="flex:1;">
                            <span>ğŸŒ</span> Danbooruè¾æ›¸æ›´æ–°
                        </button>
                        <button class="sidebar-btn" id="updateCivitaiBtn" style="flex:1;">
                            <span>ğŸ§©</span> Civitaiè¾æ›¸æ›´æ–°
                        </button>
                    </div>
                    <div id="updateProgress" style="display:none; margin-top:10px; padding:10px; background: rgba(100,200,255,0.15); border-radius:6px; color:#7bbcff; font-size:12px;">
                        <div id="updateStatus">æº–å‚™ä¸­...</div>
                        <pre id="updateDetails" style="margin:8px 0 0; white-space:pre-wrap; color:#aaddff;"></pre>
                    </div>
                    <div style="margin-top: 10px; padding: 10px; background: rgba(255,100,100,0.2); border-radius: 5px; color: #ffcccc; font-size: 0.75em; line-height: 1.4;">
                        âš ï¸ <strong>è‡ªå‹•å–ã‚Šè¾¼ã¿ç„¡åŠ¹åŒ–</strong><br>
                        Danbooruã®åˆ†é¡ä½“ç³»ã¨MetaCardãŒç•°ãªã‚‹ãŸã‚ã€è‡ªå‹•åˆ†é¡ã¯ä¸å¯èƒ½ã§ã™ã€‚<br>
                        <strong>â†’ è¾æ›¸ç·¨é›†UIï¼ˆæ‰‹å‹•ç®¡ç†ï¼‰å®Ÿè£…äºˆå®š</strong>
                    </div>
                </div>
            </div>

            <!-- Phase 11: APIã‚­ãƒ¼è¨­å®šï¼ˆé…å¸ƒå¯¾å¿œï¼‰ -->
            <div class="sidebar-section collapsed">
                <h4>ğŸ”‘ Gemini APIè¨­å®š</h4>
                <div class="sidebar-section-content">
                    <button class="sidebar-btn" id="openApiKeyModalBtn">
                        <span>âš™ï¸</span> APIã‚­ãƒ¼ç™»éŒ²
                    </button>
                    <div id="apiKeyStatus" style="margin-top: 10px; padding: 10px; background: rgba(255,200,100,0.2); border-radius: 5px; color: #ffddaa; font-size: 0.75em; line-height: 1.4;">
                        ğŸ” APIã‚­ãƒ¼: <strong>æœªç™»éŒ²</strong><br>
                        AIè‡ªå‹•åˆ†é¡ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€ç„¡æ–™ã®Gemini APIã‚­ãƒ¼ã‚’ç™»éŒ²ã—ã¦ãã ã•ã„ã€‚
                    </div>
                    <button class="sidebar-btn" id="getGeminiKeyBtn" style="margin-top: 10px; background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);">
                        <span>ğŸ“–</span> APIã‚­ãƒ¼å–å¾—æ–¹æ³•
                    </button>
                </div>
            </div>

            <!-- Phase 13.1: SD WebUIãƒãƒ¼ãƒˆè¨­å®šï¼ˆé…å¸ƒå¯¾å¿œï¼‰ -->
            <div class="sidebar-section collapsed">
                <h4>ğŸ”Œ SD WebUIè¨­å®š</h4>
                <div class="sidebar-section-content">
                    <button class="sidebar-btn" id="openPortSettingModalBtn">
                        <span>âš™ï¸</span> ãƒãƒ¼ãƒˆç•ªå·è¨­å®š
                    </button>
                    <div id="portSettingStatus" style="margin-top: 10px; padding: 10px; background: rgba(100,200,255,0.2); border-radius: 5px; color: #aaddff; font-size: 0.75em; line-height: 1.4;">
                        ğŸ” SD WebUIãƒãƒ¼ãƒˆ: <strong id="currentPortDisplay">8500</strong><br>
                        å°†æ¥ã®æ©Ÿèƒ½æ‹¡å¼µã«å‚™ãˆã¦è¨­å®šã§ãã¾ã™ã€‚
                    </div>
                </div>
            </div>

            <!-- ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ç®¡ç†ï¼ˆé…å¸ƒç”¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã¿ï¼‰ -->
            <div class="sidebar-section collapsed" id="licenseManagementSection" style="display: none;">
                <h4>ğŸ” ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ç®¡ç†</h4>
                <div class="sidebar-section-content">
                    <button class="sidebar-btn" id="openLicenseModalBtn" onclick="showLicenseModal()">
                        <span>âš™ï¸</span> ãƒ©ã‚¤ã‚»ãƒ³ã‚¹æƒ…å ±
                    </button>
                    <div id="licenseStatus" style="margin-top: 10px; padding: 10px; background: rgba(255,200,100,0.2); border-radius: 5px; color: #ffddaa; font-size: 0.75em; line-height: 1.4;">
                        ğŸ” ãƒ©ã‚¤ã‚»ãƒ³ã‚¹: <strong id="licenseTypeDisplay">èª­ã¿è¾¼ã¿ä¸­...</strong><br>
                        <span id="licenseExpiryDisplay"></span>
                    </div>
                </div>
            </div>

            <!-- Phase 12: AIåˆ†é¡æ”¯æ´ï¼ˆç„¡æ–™æ ï¼‰ -->
            <div class="sidebar-section">
                <h4>ğŸ¤– AIåˆ†é¡æ”¯æ´</h4>
                <div class="sidebar-section-content">
                    <button class="sidebar-btn" id="aiClassifyBtn" style="background: linear-gradient(135deg, #a855f7 0%, #7c3aed 100%);">
                        <span>âœ¨</span> AIè‡ªå‹•åˆ†é¡
                    </button>
                    <button class="sidebar-btn" id="learnAITagsBtn" onclick="learnAllTagsToDictionary()" style="margin-top: 10px; background: linear-gradient(135deg, #48c774 0%, #3b9d5e 100%);">
                        <span>ğŸ“š</span> AIã‚¿ã‚°ã‚’è¾æ›¸ã«å­¦ç¿’
                    </button>
                    <button class="sidebar-btn" id="sanitizeDictionaryBtn" onclick="sanitizeLearnedDictionaryManual()" style="margin-top: 10px; background: linear-gradient(135deg, #38bdf8 0%, #0ea5e9 100%);">
                        <span>ğŸ§¼</span> å­¦ç¿’è¾æ›¸ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
                    </button>
                    <div id="aiClassifyStatus" style="margin-top: 10px; padding: 10px; background: rgba(168, 85, 247, 0.2); border-radius: 5px; color: #e0b3ff; font-size: 0.75em; line-height: 1.4; display: none;">
                        â³ AIåˆ†é¡ä¸­...<br>
                        Gemini APIã§ç”»åƒã‚’è§£æã—ã¦ã„ã¾ã™
                    </div>
                </div>
            </div>

            <!-- Phase 14: SD WebUI Reforge APIæ“ä½œ -->
            <div class="sidebar-section">
                <h4>ğŸ¨ SD WebUI APIæ“ä½œ</h4>
                <div class="sidebar-section-content">
                    <button class="sidebar-btn" id="taggerAnalyzeBtn" onclick="analyzePulledImageWithTagger()" style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);">
                        <span>ğŸ”</span> Taggerè§£æ
                    </button>
                    <button class="sidebar-btn" id="generateImageBtn" onclick="generateImageWithAPI()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <span>ğŸ¨</span> ç”»åƒç”Ÿæˆ (SD)
                    </button>
                    <button class="sidebar-btn" onclick="openApiSettingsModal()" style="background: linear-gradient(135deg, #48c774 0%, #3b9d5e 100%);">
                        <span>âš™ï¸</span> APIè¨­å®š
                    </button>
                    <div id="sdApiStatus" style="margin-top: 10px; padding: 10px; background: rgba(102, 126, 234, 0.2); border-radius: 5px; color: #aab5ff; font-size: 0.75em; line-height: 1.4;">
                        ğŸ”— SD WebUI Reforgeé€£æº<br>
                        <strong>Taggerè§£æ:</strong> ãƒ‰ãƒ­ãƒƒãƒ—ç”»åƒã‹ã‚‰ã‚¿ã‚°æŠ½å‡º<br>
                        <strong>ç”»åƒç”Ÿæˆ:</strong> ç¾åœ¨ã®ã‚¿ã‚°ã‹ã‚‰ç”»åƒç”Ÿæˆ<br>
                        <strong>APIè¨­å®š:</strong> è©³ç´°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´
                    </div>
                </div>
            </div>

        </div>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <div class="main-content">
            <div class="header">
                <h1>ğŸ¨ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆåˆ†é¡ãƒ„ãƒ¼ãƒ« v3.0</h1>
                <p>Stable Diffusionç”Ÿæˆç”»åƒã‹ã‚‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å®Œå…¨æŠ½å‡ºãƒ»è‡ªå‹•åˆ†é¡</p>
            </div>

                <div class="drop-zone" id="dropZone">
                    <div class="drop-zone-icon">ğŸ“¤</div>
                    <div class="drop-zone-text">ã“ã“ã«ç”»åƒã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—<br>ï¼ˆPNG / JPEGå¯¾å¿œï¼‰</div>
                </div>

                <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºé ˜åŸŸ -->
                <div id="previewPanel" style="margin-top: 12px; display: block;">
                    <img id="previewImage" alt="ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼"
                         style="width: 320px; height: 320px; object-fit: contain;
                                border-radius: 8px; border: 1px solid #e5e7eb; display: none; background:#fff;" />
                </div>

            <div class="results-section" id="resultsSection">
                <div class="raw-prompt-box">
                    <h3>ğŸ” æŠ½å‡ºã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆåˆ†é›¢æ¸ˆã¿ï¼‰</h3>

                    <!-- âœ… UIæ”¹å–„: Positive prompt - å¸¸ã«å±•é–‹ -->
                    <div class="prompt-section" style="margin-bottom: 15px;">
                        <strong style="color: #28a745; cursor: default;">âœ… Positive prompt:</strong>
                        <div class="prompt-text" id="positivePrompt" style="background: #e8f5e9; border-left: 3px solid #28a745;"></div>
                    </div>

                    <!-- âœ… UIæ”¹å–„: Negative prompt - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæŠ˜ã‚ŠãŸãŸã¿ -->
                    <div class="prompt-section collapsed" style="margin-bottom: 15px;">
                        <strong style="color: #dc3545; cursor: pointer; display: flex; align-items: center; justify-content: space-between; padding: 4px 0;">
                            <span>âŒ Negative prompt:</span>
                            <span class="collapse-indicator" style="font-size: 0.8em; transition: transform 0.3s;">â–º</span>
                        </strong>
                        <div class="prompt-section-content" style="max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out, opacity 0.3s; opacity: 0;">
                            <div class="prompt-text" id="negativePrompt" style="background: #ffebee; border-left: 3px solid #dc3545;"></div>
                        </div>
                    </div>

                    <!-- âœ… UIæ”¹å–„: Settings - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæŠ˜ã‚ŠãŸãŸã¿ -->
                    <div class="prompt-section collapsed">
                        <strong style="color: #667eea; cursor: pointer; display: flex; align-items: center; justify-content: space-between; padding: 4px 0;">
                            <span>âš™ï¸ Settings:</span>
                            <span class="collapse-indicator" style="font-size: 0.8em; transition: transform 0.3s;">â–º</span>
                        </strong>
                        <div class="prompt-section-content" style="max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out, opacity 0.3s; opacity: 0;">
                            <div class="prompt-text" id="settingsPrompt" style="background: #e3f2fd; border-left: 3px solid #667eea;"></div>
                        </div>
                    </div>
                </div>

                <!-- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ -->
                <div class="prompt-generation-area" style="margin: 20px 0; text-align: center; display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
                    <!-- é’ãƒœã‚¿ãƒ³ï¼šå˜ä¸€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ -->
                    <button id="generatePromptBtn" class="generate-btn-single" onclick="generatePrompt()">
                        ğŸ¨ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ
                    </button>

                    <!-- ç·‘ãƒœã‚¿ãƒ³ï¼šãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå‡ºåŠ› -->
                    <button class="output-btn" onclick="outputPromptToFile()">
                        ğŸ’¾ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå‡ºåŠ›
                    </button>

                    <!-- ã‚ªãƒ¬ãƒ³ã‚¸ãƒœã‚¿ãƒ³ï¼šã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°å‡ºåŠ› -->
                    <button class="output-btn" onclick="exportConsoleLogs()" style="background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);">
                        ğŸ“‹ ãƒ­ã‚°å‡ºåŠ›
                    </button>

                    <!-- ç´«ãƒœã‚¿ãƒ³ï¼š2äººçµ±åˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ -->
                    <button id="generateDualPromptBtn" class="generate-btn-dual" onclick="generateDualPrompt()">
                        âœ¨ 2äººçµ±åˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ
                    </button>
                </div>

                <!-- ä¸‹éƒ¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º -->
                <div class="bottom-status" style="text-align: center; margin-bottom: 20px; color: #666; font-size: 14px;">
                    <span id="dualModeStatus">2äººãƒ¢ãƒ¼ãƒ‰: æœªé¸æŠ</span>
                </div>

                <!-- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå‡ºåŠ›ã‚¨ãƒªã‚¢ -->
                <div id="promptOutput" style="margin-bottom: 20px;"></div>

                <!-- Tagger ãƒ‘ãƒªãƒ†ã‚£è¡¨ç¤º -->
                <div id="taggerParityPanel" style="display:none; margin: 12px 0; padding: 12px; background:#fff; border:1px solid #e5e7eb; border-radius:8px;">
                    <h3 style="margin: 0 0 8px 0; color:#ff6b6b;">ğŸ” Taggerãƒ‘ãƒªãƒ†ã‚£ï¼ˆæ¤œè¨¼ï¼‰</h3>
                    <div style="display:flex; gap:8px; margin-bottom:8px;">
                        <button id="exportParityBtn" class="btn btn-secondary" style="padding:8px 12px;">
                            ğŸ“¥ ãƒ‘ãƒªãƒ†ã‚£JSONã‚’æ›¸ãå‡ºã™
                        </button>
                    </div>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                        <div>
                            <strong>Rawï¼ˆã‚¿ã‚°ï¼‹ã‚¹ã‚³ã‚¢ï¼‰</strong>
                            <pre id="parityRaw" style="white-space:pre-wrap; background:#f9fafb; border:1px solid #eee; padding:8px; border-radius:6px; max-height:180px; overflow:auto;"></pre>
                        </div>
                        <div>
                            <strong>é–¾å€¤å¾Œ</strong>
                            <pre id="parityThresholded" style="white-space:pre-wrap; background:#f9fafb; border:1px solid #eee; padding:8px; border-radius:6px; max-height:180px; overflow:auto;"></pre>
                        </div>
                        <div>
                            <strong>æ•´å½¢å¾Œï¼ˆäº’æ›ãƒ¢ãƒ¼ãƒ‰ã¯æœ€å°æ•´å½¢ï¼‰</strong>
                            <pre id="parityCleaned" style="white-space:pre-wrap; background:#f9fafb; border:1px solid #eee; padding:8px; border-radius:6px; max-height:180px; overflow:auto;"></pre>
                        </div>
                        <div>
                            <strong>åˆ†é¡å¾Œï¼ˆã‚«ãƒ†ã‚´ãƒªåˆ¥ï¼‰</strong>
                            <pre id="parityCategorized" style="white-space:pre-wrap; background:#f9fafb; border:1px solid #eee; padding:8px; border-radius:6px; max-height:180px; overflow:auto;"></pre>
                        </div>
                    </div>
                </div>

                <!-- ã‚»ãƒƒãƒˆä¸€è¦§ãƒ¢ãƒ¼ãƒ€ãƒ« -->
                <div id="setListModal" class="modal" style="display:none;">
                    <div class="modal-content" style="max-width: 840px; max-height: 85vh; overflow-y: auto;">
                        <h3>ğŸ“¦ ã‚»ãƒƒãƒˆé¸æŠ</h3>
                        <div style="display:flex; gap:8px; margin: 8px 0 12px;">
                            <input id="setSearchInput" placeholder="æ¤œç´¢ï¼ˆåç§°/ãƒ©ãƒ™ãƒ«/ã‚¿ã‚°ï¼‰" style="flex:1; padding:8px; border:1px solid #ddd; border-radius:6px;">
                            <button class="btn btn-secondary" id="importSetsBtn">ã‚¤ãƒ³ãƒãƒ¼ãƒˆ(JSON)</button>
                            <button class="btn btn-secondary" id="exportSetsBtn">ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ(JSON)</button>
                            <button class="btn" id="closeSetModalBtn">âœ• é–‰ã˜ã‚‹</button>
                        </div>
                        <div id="setListTargetHint" style="margin:6px 0; font-size:12px; color:#444;"></div>
                        <div style="display:flex; gap:8px; margin: 4px 0 8px;">
                            <button class="btn" id="createSetBtn">æ–°è¦ä½œæˆ</button>
                        </div>
                        <div id="setGrid" style="display:grid; grid-template-columns: repeat(3, 1fr); gap:12px;"></div>
                    </div>
                </div>

                <!-- ã‚»ãƒƒãƒˆä¿å­˜ãƒ¢ãƒ¼ãƒ€ãƒ« -->
                <div id="setSaveModal" class="modal" style="display:none;">
                    <div class="modal-content" style="max-width: 640px;">
                        <h3>ğŸ’¾ ã‚»ãƒƒãƒˆä¿å­˜</h3>
                        <div style="display:grid; grid-template-columns: 1fr 2fr; gap:10px;">
                            <label>åç§°</label> <input id="setNameInput" />
                            <label>èª¬æ˜</label> <input id="setDescInput" />
                            <label>ãƒ©ãƒ™ãƒ«ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰</label> <input id="setLabelsInput" placeholder="face,school,kimono"/>
                            <label>å¯¾è±¡ã‚«ãƒ†ã‚´ãƒª</label>
                            <div>
                                <label><input type="checkbox" class="set-cat" value="face" checked/> face</label>
                                <label><input type="checkbox" class="set-cat" value="clothing" checked/> clothing</label>
                                <label><input type="checkbox" class="set-cat" value="pose" checked/> pose</label>
                                <label><input type="checkbox" class="set-cat" value="expression" checked/> expression</label>
                                <label><input type="checkbox" class="set-cat" value="background" checked/> background</label>
                                <label><input type="checkbox" class="set-cat" value="body" checked/> body</label>
                                <label><input type="checkbox" class="set-cat" value="quality" checked/> quality</label>
                                <label><input type="checkbox" class="set-cat" value="people" checked/> people</label>
                                <label><input type="checkbox" class="set-cat" value="other" checked/> other</label>
                            </div>
                        </div>
                        <div style="display:flex; gap:10px; margin-top:12px; justify-content:flex-end;">
                            <button class="btn" id="confirmSaveSetBtn">ä¿å­˜</button>
                            <button class="btn btn-secondary" id="cancelSaveSetBtn">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                        </div>
                    </div>
                </div>

                <!-- ã‚«ãƒ†ã‚´ãƒªã‚°ãƒªãƒƒãƒ‰ï¼ˆå˜ä¸€ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ‰ï¼‰ -->
                <!-- ğŸ”¥ Phase 7.9: ã‚«ãƒ†ã‚´ãƒªä¸¦ã³é †å¤‰æ›´ - faceâ†’bodyâ†’poseâ†’clothingâ†’expressionâ†’otherâ†’qualityâ†’backgroundâ†’people -->
                <div id="singleCharacterGrid" class="categories-grid">
                    <!-- face -->
                    <div class="category-box" data-category="face">
                        <div class="category-header">
                            <div class="category-info">
                                <span class="category-icon">ğŸ‘©</span>
                                <span class="category-title">å¥³æ€§ã®é¡”</span>
                            </div>
                            <span class="category-count" id="face-count">0</span>
                            <span class="single-mode-badge">ğŸ‘¤â†’ å˜ä¸€ãƒ¢ãƒ¼ãƒ‰</span>
                        </div>
                        <div class="category-actions">
                            <button class="category-action-btn" onclick="showCategoryModal('face')">ğŸ” ã‚»ãƒƒãƒˆé¸æŠ</button>
                            <button class="category-action-btn" onclick="saveCategoryAsSet('face')">ğŸ’¾ ã‚»ãƒƒãƒˆä¿å­˜</button>
                            <button class="category-action-btn" onclick="clearCategory('face')">ğŸ—‘ï¸ ã‚¯ãƒªã‚¢</button>
                        </div>

                        <!-- ğŸ­ 2äººãƒ¢ãƒ¼ãƒ‰å°‚ç”¨ï¼šã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é¸æŠãƒœã‚¿ãƒ³ -->
                        <div class="dual-char-select-btns" id="face-dual-select" style="display: none;">
                            <button class="char1-select-btn">ğŸ‘¤ ã‚­ãƒ£ãƒ©1ã®å¥³æ€§ã®é¡”é¸æŠ</button>
                            <button class="char2-select-btn">ğŸ‘¤ ã‚­ãƒ£ãƒ©2ã®å¥³æ€§ã®é¡”é¸æŠ</button>
                        </div>

                        <!-- å˜ä¸€ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ‰ï¼šã‚¿ã‚°è¡¨ç¤º -->
                        <div class="tag-container" id="face-tags"></div>

                        <!-- ğŸ”¥ Phase 7: æ¨ªåˆ†å‰²ã‚³ãƒ³ãƒ†ãƒŠï¼ˆé©æ–°çš„ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰ -->
                        <div class="dual-char-tags" id="face-dual-tags" style="display: none;">
                            <div class="dual-char-horizontal-container">
                                <!-- å·¦åŠåˆ†: ã‚­ãƒ£ãƒ©1 -->
                                <div class="char-half char1-area">
                                    <div class="char-label">ğŸ”µ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼1</div>
                                    <div class="char1-tags" id="face-char1-tags"></div>
                                </div>

                                <!-- ä¸­å¤®åˆ†å‰²ç·š -->
                                <div class="category-divider"></div>

                                <!-- å³åŠåˆ†: ã‚­ãƒ£ãƒ©2 -->
                                <div class="char-half char2-area">
                                    <div class="char-label">ğŸŸ  ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼2</div>
                                    <div class="char2-tags" id="face-char2-tags"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- body -->
                    <div class="category-box" data-category="body">
                        <div class="category-header">
                            <div class="category-info">
                                <span class="category-icon">ğŸ’ƒ</span>
                                <span class="category-title">ä½“</span>
                            </div>
                            <span class="category-count" id="body-count">0</span>
                            <span class="single-mode-badge">ğŸ‘¤â†’ å˜ä¸€ãƒ¢ãƒ¼ãƒ‰</span>
                        </div>
                        <div class="category-actions">
                            <button class="category-action-btn" onclick="showCategoryModal('body')">ğŸ” ã‚»ãƒƒãƒˆé¸æŠ</button>
                            <button class="category-action-btn" onclick="saveCategoryAsSet('body')">ğŸ’¾ ã‚»ãƒƒãƒˆä¿å­˜</button>
                            <button class="category-action-btn" onclick="clearCategory('body')">ğŸ—‘ï¸ ã‚¯ãƒªã‚¢</button>
                        </div>

                        <!-- ğŸ­ 2äººãƒ¢ãƒ¼ãƒ‰å°‚ç”¨ï¼šã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é¸æŠãƒœã‚¿ãƒ³ -->
                        <div class="dual-char-select-btns" id="body-dual-select" style="display: none;">
                            <button class="char1-select-btn">ğŸ‘¤ ã‚­ãƒ£ãƒ©1ã®ä½“é¸æŠ</button>
                            <button class="char2-select-btn">ğŸ‘¤ ã‚­ãƒ£ãƒ©2ã®ä½“é¸æŠ</button>
                        </div>

                        <!-- å˜ä¸€ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ‰ï¼šã‚¿ã‚°è¡¨ç¤º -->
                        <div class="tag-container" id="body-tags"></div>

                        <!-- ğŸ”¥ Phase 7: æ¨ªåˆ†å‰²ã‚³ãƒ³ãƒ†ãƒŠï¼ˆé©æ–°çš„ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰ -->
                        <div class="dual-char-tags" id="body-dual-tags" style="display: none;">
                            <div class="dual-char-horizontal-container">
                                <!-- å·¦åŠåˆ†: ã‚­ãƒ£ãƒ©1 -->
                                <div class="char-half char1-area">
                                    <div class="char-label">ğŸ”µ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼1</div>
                                    <div class="char1-tags" id="body-char1-tags"></div>
                                </div>

                                <!-- ä¸­å¤®åˆ†å‰²ç·š -->
                                <div class="category-divider"></div>

                                <!-- å³åŠåˆ†: ã‚­ãƒ£ãƒ©2 -->
                                <div class="char-half char2-area">
                                    <div class="char-label">ğŸŸ  ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼2</div>
                                    <div class="char2-tags" id="body-char2-tags"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- pose -->
                    <div class="category-box" data-category="pose">
                        <div class="category-header">
                            <div class="category-info">
                                <span class="category-icon">ğŸ¤¸</span>
                                <span class="category-title">ãƒãƒ¼ã‚º</span>
                            </div>
                            <span class="category-count" id="pose-count">0</span>
                            <span class="single-mode-badge">ğŸ‘¤â†’ å˜ä¸€ãƒ¢ãƒ¼ãƒ‰</span>
                        </div>
                        <div class="category-actions">
                            <button class="category-action-btn" onclick="showCategoryModal('pose')">ğŸ” ã‚»ãƒƒãƒˆé¸æŠ</button>
                            <button class="category-action-btn" onclick="saveCategoryAsSet('pose')">ğŸ’¾ ã‚»ãƒƒãƒˆä¿å­˜</button>
                            <button class="category-action-btn" onclick="clearCategory('pose')">ğŸ—‘ï¸ ã‚¯ãƒªã‚¢</button>
                        </div>

                        <!-- ğŸ­ 2äººãƒ¢ãƒ¼ãƒ‰å°‚ç”¨ï¼šã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é¸æŠãƒœã‚¿ãƒ³ -->
                        <div class="dual-char-select-btns" id="pose-dual-select" style="display: none;">
                            <button class="char1-select-btn">ğŸ‘¤ ã‚­ãƒ£ãƒ©1ã®ãƒãƒ¼ã‚ºé¸æŠ</button>
                            <button class="char2-select-btn">ğŸ‘¤ ã‚­ãƒ£ãƒ©2ã®ãƒãƒ¼ã‚ºé¸æŠ</button>
                        </div>

                        <!-- å˜ä¸€ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ‰ï¼šã‚¿ã‚°è¡¨ç¤º -->
                        <div class="tag-container" id="pose-tags"></div>

                        <!-- ğŸ”¥ Phase 7: æ¨ªåˆ†å‰²ã‚³ãƒ³ãƒ†ãƒŠï¼ˆé©æ–°çš„ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰ -->
                        <div class="dual-char-tags" id="pose-dual-tags" style="display: none;">
                            <div class="dual-char-horizontal-container">
                                <!-- å·¦åŠåˆ†: ã‚­ãƒ£ãƒ©1 -->
                                <div class="char-half char1-area">
                                    <div class="char-label">ğŸ”µ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼1</div>
                                    <div class="char1-tags" id="pose-char1-tags"></div>
                                </div>

                                <!-- ä¸­å¤®åˆ†å‰²ç·š -->
                                <div class="category-divider"></div>

                                <!-- å³åŠåˆ†: ã‚­ãƒ£ãƒ©2 -->
                                <div class="char-half char2-area">
                                    <div class="char-label">ğŸŸ  ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼2</div>
                                    <div class="char2-tags" id="pose-char2-tags"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- clothing -->
                    <div class="category-box" data-category="clothing">
                        <div class="category-header">
                            <div class="category-info">
                                <span class="category-icon">ğŸ‘—</span>
                                <span class="category-title">æœè£…</span>
                            </div>
                            <span class="category-count" id="clothing-count">0</span>
                            <span class="single-mode-badge">ğŸ‘¤â†’ å˜ä¸€ãƒ¢ãƒ¼ãƒ‰</span>
                        </div>
                        <div class="category-actions">
                            <button class="category-action-btn" onclick="showCategoryModal('clothing')">ğŸ” ã‚»ãƒƒãƒˆé¸æŠ</button>
                            <button class="category-action-btn" onclick="saveCategoryAsSet('clothing')">ğŸ’¾ ã‚»ãƒƒãƒˆä¿å­˜</button>
                            <button class="category-action-btn" onclick="clearCategory('clothing')">ğŸ—‘ï¸ ã‚¯ãƒªã‚¢</button>
                        </div>

                        <!-- ğŸ­ 2äººãƒ¢ãƒ¼ãƒ‰å°‚ç”¨ï¼šã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é¸æŠãƒœã‚¿ãƒ³ -->
                        <div class="dual-char-select-btns" id="clothing-dual-select" style="display: none;">
                            <button class="char1-select-btn">ğŸ‘¤ ã‚­ãƒ£ãƒ©1ã®æœè£…é¸æŠ</button>
                            <button class="char2-select-btn">ğŸ‘¤ ã‚­ãƒ£ãƒ©2ã®æœè£…é¸æŠ</button>
                        </div>

                        <!-- å˜ä¸€ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ‰ï¼šã‚¿ã‚°è¡¨ç¤º -->
                        <div class="tag-container" id="clothing-tags"></div>

                        <!-- ğŸ”¥ Phase 7: æ¨ªåˆ†å‰²ã‚³ãƒ³ãƒ†ãƒŠï¼ˆé©æ–°çš„ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰ -->
                        <div class="dual-char-tags" id="clothing-dual-tags" style="display: none;">
                            <div class="dual-char-horizontal-container">
                                <!-- å·¦åŠåˆ†: ã‚­ãƒ£ãƒ©1 -->
                                <div class="char-half char1-area">
                                    <div class="char-label">ğŸ”µ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼1</div>
                                    <div class="char1-tags" id="clothing-char1-tags"></div>
                                </div>

                                <!-- ä¸­å¤®åˆ†å‰²ç·š -->
                                <div class="category-divider"></div>

                                <!-- å³åŠåˆ†: ã‚­ãƒ£ãƒ©2 -->
                                <div class="char-half char2-area">
                                    <div class="char-label">ğŸŸ  ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼2</div>
                                    <div class="char2-tags" id="clothing-char2-tags"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- expression -->
                    <div class="category-box" data-category="expression">
                        <div class="category-header">
                            <div class="category-info">
                                <span class="category-icon">ğŸ˜Š</span>
                                <span class="category-title">è¡¨æƒ…</span>
                            </div>
                            <span class="category-count" id="expression-count">0</span>
                            <span class="single-mode-badge">ğŸ‘¤â†’ å˜ä¸€ãƒ¢ãƒ¼ãƒ‰</span>
                        </div>
                        <div class="category-actions">
                            <button class="category-action-btn" onclick="showCategoryModal('expression')">ğŸ” ã‚»ãƒƒãƒˆé¸æŠ</button>
                            <button class="category-action-btn" onclick="saveCategoryAsSet('expression')">ğŸ’¾ ã‚»ãƒƒãƒˆä¿å­˜</button>
                            <button class="category-action-btn" onclick="clearCategory('expression')">ğŸ—‘ï¸ ã‚¯ãƒªã‚¢</button>
                        </div>

                        <!-- ğŸ­ Phase 7.10: 2äººãƒ¢ãƒ¼ãƒ‰å°‚ç”¨ï¼šã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é¸æŠãƒœã‚¿ãƒ³ -->
                        <div class="dual-char-select-btns" id="expression-dual-select" style="display: none;">
                            <button class="char1-select-btn">ğŸ‘¤ ã‚­ãƒ£ãƒ©1ã®è¡¨æƒ…é¸æŠ</button>
                            <button class="char2-select-btn">ğŸ‘¤ ã‚­ãƒ£ãƒ©2ã®è¡¨æƒ…é¸æŠ</button>
                        </div>

                        <!-- å˜ä¸€ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ‰ï¼šã‚¿ã‚°è¡¨ç¤º -->
                        <div class="tag-container" id="expression-tags"></div>

                        <!-- ğŸ”¥ Phase 7.10: æ¨ªåˆ†å‰²ã‚³ãƒ³ãƒ†ãƒŠï¼ˆé©æ–°çš„ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰ -->
                        <div class="dual-char-tags" id="expression-dual-tags" style="display: none;">
                            <div class="dual-char-horizontal-container">
                                <!-- å·¦åŠåˆ†: ã‚­ãƒ£ãƒ©1 -->
                                <div class="char-half char1-area">
                                    <div class="char-label">ğŸ”µ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼1</div>
                                    <div class="char1-tags" id="expression-char1-tags"></div>
                                </div>

                                <!-- ä¸­å¤®åˆ†å‰²ç·š -->
                                <div class="category-divider"></div>

                                <!-- å³åŠåˆ†: ã‚­ãƒ£ãƒ©2 -->
                                <div class="char-half char2-area">
                                    <div class="char-label">ğŸŸ  ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼2</div>
                                    <div class="char2-tags" id="expression-char2-tags"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- other -->
                    <div class="category-box" data-category="other">
                        <div class="category-header">
                            <div class="category-info">
                                <span class="category-icon">ğŸ”§</span>
                                <span class="category-title">ãã®ä»–</span>
                            </div>
                            <span class="category-count" id="other-count">0</span>
                        </div>
                        <div class="category-actions">
                            <button class="category-action-btn" onclick="showCategoryModal('other')">ğŸ” ã‚»ãƒƒãƒˆé¸æŠ</button>
                            <button class="category-action-btn" onclick="saveCategoryAsSet('other')">ğŸ’¾ ã‚»ãƒƒãƒˆä¿å­˜</button>
                            <button class="category-action-btn" onclick="clearCategory('other')">ğŸ—‘ï¸ ã‚¯ãƒªã‚¢</button>
                        </div>
                        <div class="tag-container" id="other-tags"></div>
                    </div>

                    <!-- quality -->
                    <div class="category-box" data-category="quality">
                        <div class="category-header">
                            <div class="category-info">
                                <span class="category-icon">â­</span>
                                <span class="category-title">å“è³ª</span>
                            </div>
                            <span class="category-count" id="quality-count">0</span>
                        </div>
                        <div class="category-actions">
                            <button class="category-action-btn" onclick="showCategoryModal('quality')">ğŸ” ã‚»ãƒƒãƒˆé¸æŠ</button>
                            <button class="category-action-btn" onclick="saveCategoryAsSet('quality')">ğŸ’¾ ã‚»ãƒƒãƒˆä¿å­˜</button>
                            <button class="category-action-btn" onclick="clearCategory('quality')">ğŸ—‘ï¸ ã‚¯ãƒªã‚¢</button>
                        </div>
                        <div class="tag-container" id="quality-tags"></div>
                    </div>

                    <!-- background -->
                    <div class="category-box" data-category="background">
                        <div class="category-header">
                            <div class="category-info">
                                <span class="category-icon">ğŸï¸</span>
                                <span class="category-title">èƒŒæ™¯</span>
                            </div>
                            <span class="category-count" id="background-count">0</span>
                        </div>
                        <div class="category-actions">
                            <button class="category-action-btn" onclick="showCategoryModal('background')">ğŸ” ã‚»ãƒƒãƒˆé¸æŠ</button>
                            <button class="category-action-btn" onclick="saveCategoryAsSet('background')">ğŸ’¾ ã‚»ãƒƒãƒˆä¿å­˜</button>
                            <button class="category-action-btn" onclick="clearCategory('background')">ğŸ—‘ï¸ ã‚¯ãƒªã‚¢</button>
                        </div>
                        <div class="tag-container" id="background-tags"></div>
                    </div>

                    <!-- people -->
                    <div class="category-box" data-category="people">
                        <div class="category-header">
                            <div class="category-info">
                                <span class="category-icon">ğŸ‘¥</span>
                                <span class="category-title">è¤‡æ•°äººãƒ»äººæ•°</span>
                            </div>
                            <span class="category-count" id="people-count">0</span>
                        </div>
                        <div class="category-actions">
                            <button class="category-action-btn" onclick="showCategoryModal('people')">ğŸ” ã‚»ãƒƒãƒˆé¸æŠ</button>
                            <button class="category-action-btn" onclick="saveCategoryAsSet('people')">ğŸ’¾ ã‚»ãƒƒãƒˆä¿å­˜</button>
                            <button class="category-action-btn" onclick="clearCategory('people')">ğŸ—‘ï¸ ã‚¯ãƒªã‚¢</button>
                        </div>
                        <div class="tag-container" id="people-tags"></div>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" onclick="copyAllTags()">ğŸ“‹ å…¨ä½“ã‚³ãƒ”ãƒ¼</button>
                    <button class="btn btn-secondary" onclick="reset()">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Phase 11: APIã‚­ãƒ¼è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="apiKeyModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <h2>ğŸ”‘ Gemini APIã‚­ãƒ¼è¨­å®š</h2>
            <p style="color: #aaa; font-size: 0.9em; margin: 15px 0;">
                ç„¡æ–™ã®Gemini APIã‚’ä½¿ç”¨ã—ã¦ã€Danbooruã‚¿ã‚°ã‚’è‡ªå‹•åˆ†é¡ã—ã¾ã™ã€‚<br>
                APIã‚­ãƒ¼ã¯æš—å·åŒ–ã•ã‚Œãšã€config.jsonã«å¹³æ–‡ä¿å­˜ã•ã‚Œã¾ã™ã€‚
            </p>

            <div style="margin: 20px 0;">
                <label style="display: block; margin-bottom: 10px; color: #fff; font-weight: bold;">
                    Gemini API Key:
                </label>
                <input
                    type="password"
                    id="apiKeyInput"
                    placeholder="AIzaSy...ï¼ˆ40æ–‡å­—ç¨‹åº¦ï¼‰"
                    style="width: 100%; padding: 12px; border-radius: 5px; border: 1px solid #555; background: #2a2a2a; color: #fff; font-size: 1em; box-sizing: border-box;"
                />
                <button
                    id="toggleApiKeyVisibility"
                    style="margin-top: 10px; padding: 8px 15px; background: rgba(255,255,255,0.1); border: none; color: #fff; border-radius: 5px; cursor: pointer; font-size: 0.9em;"
                >
                    ğŸ‘ï¸ è¡¨ç¤º/éè¡¨ç¤º
                </button>
            </div>

            <div style="background: rgba(76,175,80,0.2); padding: 15px; border-radius: 5px; margin: 20px 0; border-left: 4px solid #4CAF50;">
                <h4 style="margin: 0 0 10px 0; color: #4CAF50;">ğŸ“– APIã‚­ãƒ¼å–å¾—æ–¹æ³•</h4>
                <ol style="margin: 10px 0; padding-left: 20px; color: #ccc; font-size: 0.9em; line-height: 1.8;">
                    <li><a href="https://makersuite.google.com/app/apikey" target="_blank" style="color: #4CAF50;">Google AI Studio</a> ã«ã‚¢ã‚¯ã‚»ã‚¹</li>
                    <li>ã€ŒGet API Keyã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
                    <li>ã€ŒCreate API keyã€ã§æ–°ã—ã„ã‚­ãƒ¼ã‚’ä½œæˆ</li>
                    <li>ç”Ÿæˆã•ã‚ŒãŸã‚­ãƒ¼ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ä¸Šè¨˜ã«è²¼ã‚Šä»˜ã‘</li>
                </ol>
                <p style="margin: 10px 0 0 0; color: #aaa; font-size: 0.85em;">
                    âš ï¸ <strong>å®Œå…¨ç„¡æ–™</strong>ï¼ˆæœˆ15ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/åˆ†ï¼‰<br>
                    ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ç™»éŒ²ä¸è¦
                </p>
            </div>

            <div class="button-group" style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-primary" id="saveApiKeyBtn" style="flex: 1;">
                    ğŸ’¾ ä¿å­˜
                </button>
                <button class="btn btn-secondary" id="closeApiKeyModalBtn" style="flex: 1;">
                    âœ• é–‰ã˜ã‚‹
                </button>
            </div>

            <button
                id="deleteApiKeyBtn"
                style="width: 100%; margin-top: 10px; padding: 10px; background: rgba(255,0,0,0.2); border: 1px solid #ff5555; color: #ff5555; border-radius: 5px; cursor: pointer; font-size: 0.9em;"
            >
                ğŸ—‘ï¸ APIã‚­ãƒ¼ã‚’å‰Šé™¤
            </button>
        </div>
    </div>

    <!-- Phase 13.1: SD WebUIãƒãƒ¼ãƒˆè¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="portSettingModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <h2>ğŸ”Œ SD WebUIãƒãƒ¼ãƒˆç•ªå·è¨­å®š</h2>
            <p style="color: #aaa; font-size: 0.9em; margin: 15px 0;">
                SD WebUI (Stable Diffusion WebUI Forge/A1111) ã®ãƒãƒ¼ãƒˆç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚<br>
                ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯8500ã§ã™ãŒã€ã‚«ã‚¹ã‚¿ãƒ ãƒãƒ¼ãƒˆã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚
            </p>

            <div style="margin: 20px 0;">
                <label style="display: block; margin-bottom: 10px; color: #fff; font-weight: bold;">
                    ãƒãƒ¼ãƒˆç•ªå·:
                </label>
                <input
                    type="number"
                    id="portInput"
                    placeholder="7860"
                    min="1"
                    max="65535"
                    style="width: 100%; padding: 12px; border-radius: 5px; border: 1px solid #555; background: #2a2a2a; color: #fff; font-size: 1em; box-sizing: border-box;"
                />
            </div>

            <div style="background: rgba(76,175,80,0.2); padding: 15px; border-radius: 5px; margin: 20px 0; border-left: 4px solid #4CAF50;">
                <h4 style="margin: 0 0 10px 0; color: #4CAF50;">ğŸ’¡ ãƒãƒ¼ãƒˆç•ªå·ã®ç¢ºèªæ–¹æ³•</h4>
                <ul style="margin: 10px 0; padding-left: 20px; color: #ccc; font-size: 0.9em; line-height: 1.8;">
                    <li>SD WebUIèµ·å‹•æ™‚ã®ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å‡ºåŠ›ã‚’ç¢ºèª</li>
                    <li>ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼ã‚’ç¢ºèªï¼ˆä¾‹: http://127.0.0.1:7860ï¼‰</li>
                    <li>ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯7860ï¼ˆAutomatic1111/Forgeæ¨™æº–ï¼‰</li>
                    <li>ã‚«ã‚¹ã‚¿ãƒ è¨­å®šã®å ´åˆã€èµ·å‹•ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§æŒ‡å®šã—ãŸãƒãƒ¼ãƒˆç•ªå·</li>
                </ul>
            </div>

            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-primary" id="savePortBtn" style="flex: 1;">
                    ğŸ’¾ ä¿å­˜
                </button>
                <button class="btn btn-secondary" id="closePortModalBtn" style="flex: 1;">
                    âœ• é–‰ã˜ã‚‹
                </button>
            </div>

            <button
                id="resetPortBtn"
                style="width: 100%; margin-top: 10px; padding: 10px; background: rgba(255,165,0,0.2); border: 1px solid #ffa500; color: #ffa500; border-radius: 5px; cursor: pointer; font-size: 0.9em;"
            >
                ğŸ”„ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ(7860)ã«æˆ»ã™
            </button>
        </div>
    </div>

    <!-- ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="guideModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 id="guideModalTitle" style="color: #333; margin: 0;">ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³</h2>
                <button onclick="closeGuideModal()" style="background: #f44336; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 1.2em;">âœ•</button>
            </div>
            <div id="guideModalContent" style="color: #333; line-height: 1.8; white-space: pre-wrap; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;">
                <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯JavaScriptã§å‹•çš„ã«èª­ã¿è¾¼ã‚€ -->
            </div>
        </div>
    </div>

    <!-- ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ç®¡ç†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="licenseModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <h2>ğŸ” ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ç®¡ç†</h2>
            
            <!-- ãƒ©ã‚¤ã‚»ãƒ³ã‚¹æƒ…å ±è¡¨ç¤º -->
            <div id="licenseInfoSection" style="margin: 20px 0; padding: 20px; background: rgba(102, 126, 234, 0.1); border-radius: 10px; border-left: 4px solid #667eea;">
                <h3 style="margin: 0 0 15px 0; color: #667eea;">ğŸ“‹ ç¾åœ¨ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹æƒ…å ±</h3>
                <div id="licenseInfoDisplay" style="color: #fff; line-height: 1.8;">
                    <div>ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚¿ã‚¤ãƒ—: <strong id="licenseTypeInfo">èª­ã¿è¾¼ã¿ä¸­...</strong></div>
                    <div id="licenseExpiryInfo" style="margin-top: 10px;"></div>
                    <div id="licenseTrialInfo" style="margin-top: 10px;"></div>
                    <div id="licenseVerificationInfo" style="margin-top: 10px;"></div>
                </div>
            </div>

            <!-- ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰èªè¨¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div style="margin: 20px 0; padding: 20px; background: rgba(255, 200, 100, 0.1); border-radius: 10px; border-left: 4px solid #ffc864;">
                <h3 style="margin: 0 0 15px 0; color: #ffc864;">ğŸ”‘ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚­ãƒ¼èªè¨¼</h3>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 8px; color: #fff; font-weight: bold;">ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ï¼ˆãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚­ãƒ¼ï¼‰:</label>
                    <input type="text" id="licensePasscodeInput" placeholder="XXXX-XXXX-XXXX-XXXX" 
                        style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #555; background: #2a2a2a; color: #fff; font-family: monospace; letter-spacing: 2px;"
                        maxlength="19">
                    <p style="color: #aaa; font-size: 0.85em; margin: 8px 0 0 0;">
                        å½¢å¼: XXXX-XXXX-XXXX-XXXX<br>
                        è²·ã„åˆ‡ã‚Šå‹: ONET-XXXX-XXXX-XXXX<br>
                        ã‚µãƒ–ã‚¹ã‚¯æœˆé¡: SUBS-XXXX-XXXX-XXXX<br>
                        ã‚µãƒ–ã‚¹ã‚¯å¹´é¡: YEAR-XXXX-XXXX-XXXX
                    </p>
                </div>
                <button class="btn btn-primary" id="verifyLicenseBtn" onclick="verifyLicensePasscode()" style="width: 100%;">
                    âœ… èªè¨¼
                </button>
                <div id="licenseVerifyResult" style="margin-top: 15px; padding: 10px; border-radius: 5px; display: none;"></div>
            </div>

            <!-- ä½“é¨“ç‰ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div id="trialSection" style="margin: 20px 0; padding: 20px; background: rgba(76, 175, 80, 0.1); border-radius: 10px; border-left: 4px solid #4CAF50; display: none;">
                <h3 style="margin: 0 0 15px 0; color: #4CAF50;">ğŸ ä½“é¨“ç‰ˆ</h3>
                <p style="color: #fff; margin-bottom: 15px;">
                    7æ—¥é–“ã®ä½“é¨“ç‰ˆã‚’åˆ©ç”¨ã§ãã¾ã™ã€‚ä½“é¨“ç‰ˆã§ã¯å„ã‚«ãƒ†ã‚´ãƒª3å€‹ã¾ã§ã‚»ãƒƒãƒˆã‚’ç™»éŒ²ã§ãã¾ã™ã€‚è©¦ç”¨æœŸé–“çµ‚äº†å¾Œã¯ã‚»ãƒƒãƒˆã®ä¿å­˜ãƒ»ç·¨é›†ãŒã§ããªããªã‚Šã¾ã™ã€‚
                </p>
                <button class="btn btn-primary" id="activateTrialBtn" onclick="activateTrialLicense()" style="width: 100%; background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);">
                    ğŸ ä½“é¨“ç‰ˆã‚’æœ‰åŠ¹åŒ–
                </button>
            </div>

            <!-- å®šæœŸèªè¨¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³å‹ã®ã¿ï¼‰ -->
            <div id="verificationSection" style="margin: 20px 0; padding: 20px; background: rgba(255, 152, 0, 0.1); border-radius: 10px; border-left: 4px solid #ff9800; display: none;">
                <h3 style="margin: 0 0 15px 0; color: #ff9800;">ğŸ”’ å®šæœŸèªè¨¼</h3>
                <p style="color: #fff; margin-bottom: 15px;">
                    ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³å‹ã§ã¯ã€å®šæœŸçš„ãªèªè¨¼ãŒå¿…è¦ã§ã™ã€‚èªè¨¼ã‚’å®Œäº†ã—ã¦ãã ã•ã„ã€‚
                </p>
                <button class="btn btn-primary" id="completeVerificationBtn" onclick="completeLicenseVerification()" style="width: 100%; background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);">
                    âœ… èªè¨¼ã‚’å®Œäº†
                </button>
            </div>

            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeLicenseModal()" style="flex: 1;">
                    âœ• é–‰ã˜ã‚‹
                </button>
            </div>
        </div>
    </div>

    <!-- Phase 14.2: APIè¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="apiSettingsModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 700px; max-height: 85vh; overflow-y: auto;">
            <h2>âš™ï¸ SD WebUI API è©³ç´°è¨­å®š</h2>

            <!-- Taggerè¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div style="margin: 25px 0; padding: 20px; background: rgba(255,107,107,0.1); border-radius: 10px; border-left: 4px solid #ff6b6b;">
                <h3 style="margin: 0 0 15px 0; color: #ff6b6b;">ğŸ” Tagger APIè¨­å®š</h3>

                <div style="margin: 15px 0;">
                    <label style="display: block; margin-bottom: 8px; color: #fff; font-weight: bold;">Threshold (é–¾å€¤):</label>
                    <input type="range" id="taggerThreshold" min="0.1" max="0.9" step="0.05" value="0.35"
                        style="width: 100%;"
                        oninput="document.getElementById('taggerThresholdValue').textContent = this.value">
                    <span id="taggerThresholdValue" style="color: #aab5ff; font-size: 0.9em;">0.35</span>
                    <p style="color: #aaa; font-size: 0.85em; margin: 8px 0 0 0;">
                        ä½ã„å€¤ = ã‚¿ã‚°æ•°å¢—åŠ ï¼ˆãƒã‚¤ã‚ºå¤šï¼‰ã€é«˜ã„å€¤ = ã‚¿ã‚°æ•°æ¸›å°‘ï¼ˆç²¾åº¦é«˜ï¼‰
                    </p>
                </div>

                <div style="margin: 15px 0;">
                    <label style="display: block; margin-bottom: 8px; color: #fff; font-weight: bold;">Tagger Model:</label>
                    <select id="taggerModel" style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #555; background: #2a2a2a; color: #fff;">
                        <option value="wd14-vit.v2">wd14-vit.v2 (æ¨å¥¨)</option>
                        <option value="wd14-convnext.v2">wd14-convnext.v2</option>
                        <option value="wd14-swinv2.v2">wd14-swinv2.v2</option>
                        <option value="wd14-vit.v3">wd14-vit.v3</option>
                    </select>
                    <p style="color: #aaa; font-size: 0.85em; margin: 8px 0 0 0;">
                        WD14ã‚·ãƒªãƒ¼ã‚ºã¯ã‚¢ãƒ‹ãƒ¡ç”»åƒã‚¿ã‚°ä»˜ã‘ã«æœ€é©åŒ–
                    </p>
                </div>

                <div style="margin: 15px 0;">
                    <label style="display: flex; align-items: center; gap:10px; cursor: pointer;">
                        <input type="checkbox" id="taggerCompatMode" style="width: 18px; height: 18px;">
                        <span style="color: #fff; font-weight: bold;">WD14äº’æ›ãƒ¢ãƒ¼ãƒ‰ï¼ˆå¾Œå‡¦ç†ã‚’æœ€å°åŒ–ï¼‰</span>
                    </label>
                    <p style="color: #aaa; font-size: 0.85em; margin: 8px 0 0 0;">
                        ãƒã‚¤ã‚ºé™¤å»ã®ã¿è¡Œã„ã€ã‚¿ã‚°ã®çµ±åˆã‚„ç«¶åˆè§£æ¶ˆã‚’æœ€å°é™ã«ã—ã¾ã™ï¼ˆæœ¬å®¶å‡ºåŠ›ã«è¿‘ã„çµæœï¼‰
                    </p>
                </div>
            </div>

            <!-- ç”»åƒç”Ÿæˆè¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div style="margin: 25px 0; padding: 20px; background: rgba(102,126,234,0.1); border-radius: 10px; border-left: 4px solid #667eea;">
                <h3 style="margin: 0 0 15px 0; color: #667eea;">ğŸ¨ txt2img APIè¨­å®š</h3>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div>
                        <label style="display: block; margin-bottom: 8px; color: #fff; font-weight: bold;">Width:</label>
                        <input type="number" id="imageWidth" value="512" min="64" max="2048" step="64"
                            style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #555; background: #2a2a2a; color: #fff;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 8px; color: #fff; font-weight: bold;">Height:</label>
                        <input type="number" id="imageHeight" value="512" min="64" max="2048" step="64"
                            style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #555; background: #2a2a2a; color: #fff;">
                    </div>
                </div>

                <div style="margin: 15px 0;">
                    <label style="display: block; margin-bottom: 8px; color: #fff; font-weight: bold;">Steps:</label>
                    <input type="range" id="imageSteps" min="10" max="50" step="5" value="20"
                        style="width: 100%;"
                        oninput="document.getElementById('imageStepsValue').textContent = this.value">
                    <span id="imageStepsValue" style="color: #aab5ff; font-size: 0.9em;">20</span>
                    <p style="color: #aaa; font-size: 0.85em; margin: 8px 0 0 0;">
                        é«˜ã„å€¤ = å“è³ªå‘ä¸Šãƒ»ç”Ÿæˆæ™‚é–“å¢—åŠ ã€ä½ã„å€¤ = é«˜é€Ÿç”Ÿæˆ
                    </p>
                </div>

                <div style="margin: 15px 0;">
                    <label style="display: block; margin-bottom: 8px; color: #fff; font-weight: bold;">CFG Scale:</label>
                    <input type="range" id="imageCfgScale" min="1" max="20" step="0.5" value="7"
                        style="width: 100%;"
                        oninput="document.getElementById('imageCfgScaleValue').textContent = this.value">
                    <span id="imageCfgScaleValue" style="color: #aab5ff; font-size: 0.9em;">7</span>
                    <p style="color: #aaa; font-size: 0.85em; margin: 8px 0 0 0;">
                        ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå¿ å®Ÿåº¦ï¼ˆæ¨å¥¨: 7-12ï¼‰
                    </p>
                </div>

                <div style="margin: 15px 0;">
                    <label style="display: block; margin-bottom: 8px; color: #fff; font-weight: bold;">Sampler:</label>
                    <select id="imageSampler" style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #555; background: #2a2a2a; color: #fff;">
                        <option value="DPM++ 2M">DPM++ 2M (æ¨å¥¨)</option>
                        <option value="DPM++ 2M Karras">DPM++ 2M Karras</option>
                        <option value="DPM++ SDE Karras">DPM++ SDE Karras</option>
                        <option value="Euler a">Euler a</option>
                        <option value="Euler">Euler</option>
                        <option value="DDIM">DDIM</option>
                        <option value="UniPC">UniPC</option>
                    </select>
                </div>

                <div style="margin: 15px 0;">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" id="restoreFaces" style="margin-right: 10px; width: 18px; height: 18px;">
                        <span style="color: #fff; font-weight: bold;">Restore Faces (é¡”ä¿®å¾©)</span>
                    </label>
                </div>

                <!-- âœ¨ æ–°æ©Ÿèƒ½: Checkpointï¼ˆãƒ¢ãƒ‡ãƒ«ï¼‰é¸æŠ -->
                <div style="margin: 15px 0;">
                    <label style="display: block; margin-bottom: 8px; color: #fff; font-weight: bold;">ğŸ¨ Checkpoint (Model):</label>
                    <input type="text" id="sdModelCheckpoint" value="" placeholder="ä¾‹: model_name.safetensors"
                        style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #555; background: #2a2a2a; color: #fff;">
                    <p style="color: #aaa; font-size: 0.85em; margin: 8px 0 0 0;">
                        ğŸ”§ ä½¿ç”¨ã™ã‚‹SDãƒ¢ãƒ‡ãƒ«ã‚’æŒ‡å®šï¼ˆç©ºæ¬„=ç¾åœ¨ã®ãƒ¢ãƒ‡ãƒ«ä½¿ç”¨ï¼‰<br>
                        ä¾‹: illustriousXL_v01.safetensors, animagineXLV3.safetensors
                    </p>
                </div>
            </div>

            <div style="display: flex; gap: 10px; margin-top: 25px;">
                <button onclick="saveApiSettings()" style="flex: 1; padding: 15px; background: linear-gradient(135deg, #48c774 0%, #3b9d5e 100%); color: white; border: none; border-radius: 25px; cursor: pointer; font-size: 1em; font-weight: bold;">
                    ğŸ’¾ è¨­å®šã‚’ä¿å­˜
                </button>
                <button onclick="document.getElementById('apiSettingsModal').style.display='none'" style="flex: 1; padding: 15px; background: linear-gradient(135deg, #636363 0%, #4a4a4a 100%); color: white; border: none; border-radius: 25px; cursor: pointer; font-size: 1em; font-weight: bold;">
                    âœ• é–‰ã˜ã‚‹
                </button>
            </div>
        </div>
    </div>

    <!-- ã‚»ãƒƒãƒˆç®¡ç†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="categorySetModalOverlay" class="set-modal-overlay">
        <div class="set-modal">
            <div class="set-modal-header">
                <div class="set-modal-title-group">
                    <h2 id="categorySetModalTitle" class="set-modal-title">ã‚»ãƒƒãƒˆé¸æŠ</h2>
                    <p id="categorySetModalSubtitle" class="set-modal-subtitle"></p>
                </div>
                <button class="set-modal-close" onclick="window.categorySets?.closeCategorySetModal?.()">Ã—</button>
            </div>
            <div class="set-modal-body" id="categorySetModalBody"></div>
        </div>
    </div>

    <!-- ã‚»ãƒƒãƒˆç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="setEditOverlay" class="set-edit-overlay">
        <div class="set-edit-modal">
            <div class="set-edit-header">
                <div>
                    <h3>ã‚»ãƒƒãƒˆç·¨é›†</h3>
                    <p id="setEditSubtitle" class="set-edit-subtitle"></p>
                </div>
                <button class="set-edit-close" onclick="window.categorySets?.closeEditModal?.()">Ã—</button>
            </div>

            <div class="set-edit-body">
                <div class="set-managers-row">
                    <div class="set-group-manager">
                        <div class="set-section-row">
                            <span class="set-section-label">ç¾åœ¨ã®ã‚°ãƒ«ãƒ¼ãƒ—</span>
                            <span id="editCurrentGroup" class="set-section-chip">default</span>
                        </div>
                        <div class="set-section-row">
                            <label class="set-section-label" for="editSetGroup">ã‚°ãƒ«ãƒ¼ãƒ—å¤‰æ›´</label>
                            <select id="editSetGroup"></select>
                        </div>
                        <div class="set-group-actions">
                            <input id="newGroupInput" type="text" placeholder="æ–°ã—ã„ã‚°ãƒ«ãƒ¼ãƒ—å" />
                            <button id="createGroupBtn" class="set-action-button set-action-button--create">ï¼‹ æ–°è¦ã‚°ãƒ«ãƒ¼ãƒ—</button>
                        </div>
                        <div class="set-group-actions">
                            <input id="renameGroupInput" type="text" placeholder="ç¾åœ¨ã®ã‚°ãƒ«ãƒ¼ãƒ—åã‚’å¤‰æ›´" />
                            <button id="renameGroupBtn" class="set-action-button set-action-button--rename">âœï¸ ã‚°ãƒ«ãƒ¼ãƒ—åå¤‰æ›´</button>
                            <button id="deleteGroupBtn" class="set-action-button set-action-button--delete">ğŸ—‘ ã‚°ãƒ«ãƒ¼ãƒ—å‰Šé™¤</button>
                        </div>
                    </div>

                    <div class="set-section-manager">
                        <div class="set-section-row">
                            <span class="set-section-label">ç¾åœ¨ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³</span>
                            <span id="editCurrentSection" class="set-section-chip">-</span>
                        </div>
                        <div class="set-section-row">
                            <label class="set-section-label" for="editSetSection">ã‚»ã‚¯ã‚·ãƒ§ãƒ³å¤‰æ›´</label>
                            <select id="editSetSection"></select>
                        </div>
                        <div class="set-section-actions">
                            <input id="newSectionInput" type="text" placeholder="æ–°ã—ã„ã‚»ã‚¯ã‚·ãƒ§ãƒ³å" />
                            <button id="createSectionBtn" class="set-action-button set-action-button--create">ï¼‹ æ–°è¦ã‚»ã‚¯ã‚·ãƒ§ãƒ³</button>
                        </div>
                        <div class="set-section-actions">
                            <input id="renameSectionInput" type="text" placeholder="ã‚»ã‚¯ã‚·ãƒ§ãƒ³åã‚’å¤‰æ›´" />
                            <button id="renameSectionBtn" class="set-action-button set-action-button--rename">âœï¸ ã‚»ã‚¯ã‚·ãƒ§ãƒ³åå¤‰æ›´</button>
                            <button id="deleteSectionBtn" class="set-action-button set-action-button--delete">ğŸ—‘ ã‚»ã‚¯ã‚·ãƒ§ãƒ³å‰Šé™¤</button>
                        </div>
                    </div>
                </div>

                <div class="set-edit-fields">
                    <div class="form-field form-field--full">
                        <label for="editSetName">ã‚»ãƒƒãƒˆå</label>
                        <input id="editSetName" type="text" placeholder="ä¾‹: æ­£é¢ãƒãƒ¼ã‚º A">
                    </div>

                    <div class="form-field form-field--full">
                        <label for="editSetTags">ã‚¿ã‚°ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰</label>
                        <textarea id="editSetTags" rows="5" placeholder="tag1, tag2, tag3"></textarea>
                    </div>

                    <div class="form-field">
                        <label for="editMetaType">ã‚¿ã‚¤ãƒ—</label>
                        <input id="editMetaType" type="text" placeholder="ä¾‹: portrait, pose" />
                    </div>

                    <div class="form-field form-field--small">
                        <label for="editMetaRating">å±æ€§</label>
                        <select id="editMetaRating">
                            <option value="normal">normal</option>
                            <option value="nsfw">nsfw</option>
                            <option value="mature">mature</option>
                            <option value="sfw">sfw</option>
                            <option value="restricted">restricted</option>
                        </select>
                    </div>

                    <div class="form-field form-field--full">
                        <label for="editMetaTags">ãƒ¡ã‚¿ã‚¿ã‚°ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰</label>
                        <input id="editMetaTags" type="text" placeholder="ä¾‹: face, 3d, cosplay" />
                    </div>

                    <div class="form-field form-field--full">
                        <label for="editMetaNotes">ãƒ¡ãƒ¢</label>
                        <textarea id="editMetaNotes" rows="3" placeholder="è£œè¶³æƒ…å ±ã‚„æ³¨æ„ç‚¹ã‚’å…¥åŠ›"></textarea>
                    </div>
                </div>
            </div>

            <div class="set-edit-footer">
                <button class="set-edit-cancel" onclick="window.categorySets?.closeEditModal?.()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button class="set-edit-save" onclick="window.categorySets?.saveEditedSet?.()">ã‚»ãƒƒãƒˆæ›´æ–°</button>
            </div>
        </div>
    </div>

    <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³åå¤‰æ›´ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="sectionRenameOverlay" class="section-rename-overlay">
        <div class="section-rename-dialog">
            <h3>ã‚»ã‚¯ã‚·ãƒ§ãƒ³åã®å¤‰æ›´</h3>
            <p class="section-rename-caption">æ–°ã—ã„ã‚»ã‚¯ã‚·ãƒ§ãƒ³åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>
            <input id="sectionRenameDialogInput" type="text" placeholder="ä¾‹: åŸºæœ¬ã‚»ãƒƒãƒˆ" />
            <p id="sectionRenameDialogError" class="section-rename-error" style="display:none;"></p>
            <div class="section-rename-actions">
                <button id="sectionRenameCancelBtn" class="section-rename-cancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button id="sectionRenameConfirmBtn" class="section-rename-confirm">å¤‰æ›´ã‚’ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- ç”»åƒç™»éŒ²ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="setImageOverlay" class="set-image-overlay">
        <div class="set-image-modal-box">
            <div class="set-image-header">
                <h3 id="imageModalTitle">ç”»åƒã‚’ç™»éŒ²</h3>
                <p id="setImageSavePath" class="set-image-subtitle">ä¿å­˜å…ˆ: data/sets/images/thumbnails/</p>
                <button class="set-image-close" onclick="window.categorySets?.closeImageModal?.()">Ã—</button>
            </div>

            <div id="imageDropZone" class="image-drop-zone">
                <div class="image-drop-inner">
                    <span class="image-drop-icon">ğŸ“‚</span>
                    <p>ç”»åƒã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—<br>ã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</p>
                    <small>å¯¾å¿œå½¢å¼: PNG / JPG / JPEG / WEBP</small>
                </div>
            </div>
            <input id="imageFileInput" type="file" accept="image/png,image/jpeg,image/jpg,image/webp" style="display: none;">

            <div id="currentImageContainer" class="current-image-container" style="display:none;">
                <div class="current-image-card">
                    <img id="setImagePreview" alt="ç¾åœ¨ã®ç™»éŒ²ç”»åƒ">
                    <div class="current-image-meta">
                        <span id="currentImageName"></span>
                        <button id="removeImageBtn" class="current-image-delete">ğŸ—‘ ç™»éŒ²ç”»åƒã‚’å‰Šé™¤</button>
                    </div>
                </div>
            </div>

            <div class="image-actions">
                <button class="image-cancel" onclick="window.categorySets?.closeImageModal?.()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button class="image-save" onclick="window.categorySets?.saveSetImage?.()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <script>
    // Phase 14.2: APIè¨­å®šä¿å­˜é–¢æ•°
    function saveApiSettings() {
        const taggerSettings = {
            model: document.getElementById('taggerModel').value,
            threshold: parseFloat(document.getElementById('taggerThreshold').value),
            compatMode: document.getElementById('taggerCompatMode').checked
        };

        const txt2imgSettings = {
            width: parseInt(document.getElementById('imageWidth').value),
            height: parseInt(document.getElementById('imageHeight').value),
            steps: parseInt(document.getElementById('imageSteps').value),
            sampler_name: document.getElementById('imageSampler').value,
            cfg_scale: parseFloat(document.getElementById('imageCfgScale').value),
            restore_faces: document.getElementById('restoreFaces').checked,
            sd_model_checkpoint: document.getElementById('sdModelCheckpoint').value.trim()
        };

        updateTaggerSettings(taggerSettings);
        updateTxt2ImgSettings(txt2imgSettings);

        // JSONã«æ°¸ç¶šåŒ–ï¼ˆElectronçµŒç”±ï¼‰
        if (window.electronAPI && window.electronAPI.saveApiSettings) {
            window.electronAPI.saveApiSettings({ tagger: taggerSettings, txt2img: txt2imgSettings })
                .then(res => {
                    if (res && res.success) {
                        console.log('âœ… SD APIè¨­å®šã‚’config.jsonã«ä¿å­˜');
                    } else {
                        console.warn('âš ï¸ SD APIè¨­å®šã®ä¿å­˜ã«å¤±æ•—:', res && res.error);
                    }
                })
                .catch(err => console.warn('âš ï¸ SD APIè¨­å®šã®ä¿å­˜ã‚¨ãƒ©ãƒ¼:', err));
        }

        document.getElementById('apiSettingsModal').style.display = 'none';
    }

    // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã„ã¦ç¾åœ¨ã®è¨­å®šã‚’èª­ã¿è¾¼ã‚€
    function openApiSettingsModal() {
        // classifier.jsã‹ã‚‰SD_API_SETTINGSã‚’å–å¾—
        if (typeof SD_API_SETTINGS !== 'undefined') {
            // Taggerè¨­å®š
            document.getElementById('taggerModel').value = SD_API_SETTINGS.tagger.model || 'wd14-vit.v2';
            const thr = SD_API_SETTINGS.tagger.threshold || 0.35;
            document.getElementById('taggerThreshold').value = thr;
            const thrView = document.getElementById('taggerThresholdValue');
            if (thrView) thrView.textContent = String(thr);
            document.getElementById('taggerCompatMode').checked = !!SD_API_SETTINGS.tagger.compatMode;

            // txt2imgè¨­å®š
            document.getElementById('imageWidth').value = SD_API_SETTINGS.txt2img.width || 512;
            document.getElementById('imageHeight').value = SD_API_SETTINGS.txt2img.height || 512;
            document.getElementById('imageSteps').value = SD_API_SETTINGS.txt2img.steps || 20;
            document.getElementById('imageSampler').value = SD_API_SETTINGS.txt2img.sampler_name || 'DPM++ 2M';
            document.getElementById('imageCfgScale').value = SD_API_SETTINGS.txt2img.cfg_scale || 7;
            document.getElementById('restoreFaces').checked = SD_API_SETTINGS.txt2img.restore_faces || false;
            document.getElementById('sdModelCheckpoint').value = SD_API_SETTINGS.txt2img.sd_model_checkpoint || '';
        }

        // ã•ã‚‰ã«ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜å€¤ãŒã‚ã‚Œã°å„ªå…ˆèª­è¾¼
        if (window.electronAPI && window.electronAPI.loadApiSettings) {
            window.electronAPI.loadApiSettings().then(res => {
                if (res && res.success && res.settings) {
                    const s = res.settings;
                    if (s.tagger) {
                        if (s.tagger.model) document.getElementById('taggerModel').value = s.tagger.model;
                        if (typeof s.tagger.threshold === 'number') document.getElementById('taggerThreshold').value = s.tagger.threshold;
                    }
                    if (s.txt2img) {
                        if (s.txt2img.width) document.getElementById('imageWidth').value = s.txt2img.width;
                        if (s.txt2img.height) document.getElementById('imageHeight').value = s.txt2img.height;
                        if (s.txt2img.steps) document.getElementById('imageSteps').value = s.txt2img.steps;
                        if (s.txt2img.sampler_name) document.getElementById('imageSampler').value = s.txt2img.sampler_name;
                        if (typeof s.txt2img.cfg_scale === 'number') document.getElementById('imageCfgScale').value = s.txt2img.cfg_scale;
                        document.getElementById('restoreFaces').checked = !!s.txt2img.restore_faces;
                        document.getElementById('sdModelCheckpoint').value = s.txt2img.sd_model_checkpoint || '';
                    }
                }
            }).catch(() => {});
        }

        // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
        document.getElementById('apiSettingsModal').style.display = 'block';
    }

    // ãƒ¢ãƒ¼ãƒ€ãƒ«èµ·å‹•æ™‚ã«ç¾åœ¨ã®è¨­å®šã‚’ãƒ­ãƒ¼ãƒ‰
    document.getElementById('apiSettingsModal').addEventListener('click', function(e) {
        if (e.target.id === 'apiSettingsModal') {
            this.style.display = 'none';
        }
    });

    // ãƒ‘ãƒªãƒ†ã‚£JSONæ›¸ãå‡ºã—
    (function(){
      const exportBtn = document.getElementById('exportParityBtn');
      if (exportBtn && window.electronAPI && window.electronAPI.saveDebugJson) {
          exportBtn.addEventListener('click', async () => {
              try {
                  const payload = {
                      image: (window.currentImageFile && window.currentImageFile.name) || null,
                      settings: { tagger: SD_API_SETTINGS.tagger },
                      parity: window.lastTaggerParity || null
                  };
                  const res = await window.electronAPI.saveDebugJson(payload);
                  if (res && res.success) {
                      alert(`âœ… ãƒ‘ãƒªãƒ†ã‚£ã‚’æ›¸ãå‡ºã—ã¾ã—ãŸ\n${res.file}`);
                  } else {
                      alert(`âŒ æ›¸ãå‡ºã—ã«å¤±æ•—ã—ã¾ã—ãŸ\n${(res && res.error) || ''}`);
                  }
              } catch (e) {
                  alert(`âŒ æ›¸ãå‡ºã—ã‚¨ãƒ©ãƒ¼: ${e.message}`);
              }
          });
      }
    })();
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.0.4/pako_inflate.min.js"></script>
    <script src="CharacterSeparator.js"></script>
    <script src="MultiCharacterManager.js"></script>
    <script src="learn-all.js"></script>
    <!-- YAMLç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆclassifier.jsã‚ˆã‚Šå‰ã«èª­ã¿è¾¼ã‚€ï¼‰ -->
    <script src="yaml_generator_system/modules/keyword-database.js"></script>
    <script src="yaml_generator_system/modules/classifier.js"></script>
    <script src="yaml_generator_system/modules/yaml-generator.js"></script>
    <script src="yaml_generator_system/modules/text-extractor.js"></script>
    <script src="yaml_generator_system/modules/file-handler.js"></script>
    <script src="yaml_generator_system/modules/ui-renderer.js"></script>
    <script src="yaml_generator_system/yaml-generator.js"></script>
    <script src="classifier.js"></script>
    <script src="category-sets.js"></script>
    <!-- ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="storyPromptModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 10000; align-items: center; justify-content: center;">
        <div class="modal-content" style="width: 95%; height: 95vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 16px; position: relative; display: flex; flex-direction: column; box-shadow: 0 20px 60px rgba(0,0,0,0.5);">
            <div class="modal-header" style="padding: 20px 25px; background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); border-bottom: 2px solid rgba(255,255,255,0.2); flex-shrink: 0; border-radius: 16px 16px 0 0;">
                <h2 style="margin: 0; color: white; font-size: 28px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">ğŸ“– ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚·ã‚¹ãƒ†ãƒ  v2.0</h2>
                <button class="close-btn" onclick="closeStoryPrompt()" style="position: absolute; top: 20px; right: 25px; font-size: 32px; background: rgba(255,255,255,0.2); border: none; cursor: pointer; color: white; width: 40px; height: 40px; border-radius: 50%; transition: all 0.3s;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">Ã—</button>
            </div>
            <div class="modal-body" style="display: flex; gap: 20px; padding: 20px; height: 100%; overflow: hidden;">
                <!-- å·¦å´ï¼šè¨­å®šã‚¨ãƒªã‚¢ -->
                <div style="width: 320px; flex-shrink: 0; overflow-y: auto; background: rgba(255,255,255,0.95); border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                    <h3 style="margin-top: 0; color: #667eea; font-size: 20px; border-bottom: 3px solid #667eea; padding-bottom: 10px;">ğŸŒ å…±é€šè¨­å®š</h3>
                    <div style="margin-bottom: 15px; padding: 12px; background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%); border-radius: 8px; border: 2px solid #fdcb6e;">
                        <label style="font-weight: bold; display: flex; align-items: center; gap: 8px; color: #2d3436; font-size: 14px; cursor: pointer;">
                            <input type="checkbox" id="storyMultiGirlMode" style="width: 18px; height: 18px; cursor: pointer;" onchange="toggleMultiGirlMode()">
                            <span>ğŸ‘¥ è¤‡æ•°äººå¥³æ€§ãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ¬ã‚ºã‚·ãƒ¼ãƒ³ãƒ»è¤‡æ•°äººå¥³æ€§ç”Ÿæˆï¼‰</span>
                        </label>
                    </div>
                    <div id="storySingleGirlArea" style="margin-bottom: 15px;">
                        <label style="font-weight: bold; display: block; margin-bottom: 8px; color: #333; font-size: 14px;">ğŸ˜Š å¥³æ€§ã®é¡”</label>
                        <select id="storyFaceSelect" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; background: white; transition: all 0.3s;" onfocus="this.style.borderColor='#667eea'" onblur="this.style.borderColor='#e0e0e0'">
                            <option value="">é¸æŠ...</option>
                        </select>
                    </div>
                    <div id="storyMultiGirlArea" style="margin-bottom: 15px; display: none;">
                        <label style="font-weight: bold; display: block; margin-bottom: 8px; color: #333; font-size: 14px;">ğŸ‘¥ è¤‡æ•°äººå¥³æ€§ã®é¡”ï¼ˆæœ€å¤§5äººï¼‰</label>
                        <div id="storyMultiGirlFacesContainer" style="display: flex; flex-direction: column; gap: 10px;">
                            <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ï¼ˆæœ€å¤§5äººåˆ†ã®ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ï¼‰ -->
                        </div>
                        <button onclick="addMultiGirlFace()" style="width: 100%; margin-top: 10px; padding: 8px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 13px; font-weight: bold; transition: all 0.3s;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">â• å¥³æ€§ã‚’è¿½åŠ </button>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="font-weight: bold; display: block; margin-bottom: 8px; color: #333; font-size: 14px;">ğŸ’ƒ ä½“</label>
                        <select id="storyBodySelect" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; background: white; transition: all 0.3s;" onfocus="this.style.borderColor='#667eea'" onblur="this.style.borderColor='#e0e0e0'">
                            <option value="">é¸æŠ...</option>
                        </select>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="font-weight: bold; display: block; margin-bottom: 8px; color: #333; font-size: 14px;">ğŸï¸ èƒŒæ™¯</label>
                        <select id="storyBackgroundSelect" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; background: white; transition: all 0.3s;" onfocus="this.style.borderColor='#667eea'" onblur="this.style.borderColor='#e0e0e0'">
                            <option value="">é¸æŠ...</option>
                        </select>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="font-weight: bold; display: block; margin-bottom: 8px; color: #333; font-size: 14px;">ğŸ‘— æœè£…</label>
                        <select id="storyClothingSelect" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; background: white; transition: all 0.3s;" onfocus="this.style.borderColor='#667eea'" onblur="this.style.borderColor='#e0e0e0'">
                            <option value="">é¸æŠ...</option>
                        </select>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="font-weight: bold; display: block; margin-bottom: 8px; color: #333; font-size: 14px;">ğŸ‘¨ ç«¿å½¹ç”·æ€§</label>
                        <select id="storyMaleCharacterSelect" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; background: white; transition: all 0.3s;" onfocus="this.style.borderColor='#667eea'" onblur="this.style.borderColor='#e0e0e0'">
                            <option value="">é¸æŠãªã—ï¼ˆä¸€äººç”¨ï¼‰</option>
                        </select>
                    </div>
                    <div id="storyMaleClothingStateArea" style="margin-bottom: 15px; display: none;">
                        <label style="font-weight: bold; display: block; margin-bottom: 8px; color: #333; font-size: 14px;">ğŸ‘” ç”·æ€§æœè£…çŠ¶æ…‹</label>
                        <select id="storyMaleClothingStateSelect" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; background: white; transition: all 0.3s;" onfocus="this.style.borderColor='#667eea'" onblur="this.style.borderColor='#e0e0e0'">
                            <option value="">é€šå¸¸</option>
                            <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ï¼ˆä½“ã‚«ãƒ†ã‚´ãƒªã®ã€Œæœè£…çŠ¶æ…‹ã€ã‚°ãƒ«ãƒ¼ãƒ—ã‹ã‚‰å–å¾—ï¼‰ -->
                        </select>
                    </div>
                    
                    <div style="height: 2px; background: linear-gradient(to right, #667eea, #764ba2); margin: 25px 0;"></div>
                    
                    <h3 style="color: #764ba2; font-size: 20px; border-bottom: 3px solid #764ba2; padding-bottom: 10px; margin-bottom: 15px;">ğŸ¤¸ ãƒãƒ¼ã‚ºé¸æŠ</h3>
                    <div style="margin-bottom: 15px;">
                        <label style="font-weight: bold; display: block; margin-bottom: 8px; color: #333; font-size: 14px;">ğŸ“‚ ã‚°ãƒ«ãƒ¼ãƒ—</label>
                        <select id="storyPoseGroupSelect" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; background: white; transition: all 0.3s;" onfocus="this.style.borderColor='#764ba2'" onblur="this.style.borderColor='#e0e0e0'">
                            <option value="default">ğŸ¨ default</option>
                            <option value="nsfw">ğŸ” nsfw</option>
                        </select>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="font-weight: bold; display: block; margin-bottom: 8px; color: #333; font-size: 14px;">ğŸ“‘ ã‚»ã‚¯ã‚·ãƒ§ãƒ³</label>
                        <select id="storyPoseSectionSelect" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; background: white; transition: all 0.3s;" onfocus="this.style.borderColor='#764ba2'" onblur="this.style.borderColor='#e0e0e0'">
                            <option value="">é¸æŠ...</option>
                        </select>
                    </div>
                </div>
                
                <!-- ä¸­å¤®ï¼šãƒãƒ¼ã‚ºã‚«ãƒ¼ãƒ‰è¡¨ç¤º -->
                <div style="flex: 1; display: flex; flex-direction: column; overflow: hidden; background: rgba(255,255,255,0.95); border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                    <div id="storyPoseCardsArea" style="flex: 1; overflow-y: auto; display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; align-content: start; padding: 15px; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); border-radius: 12px;">
                        <div style="grid-column: 1/-1; text-align: center; color: #666; padding: 60px; font-size: 18px; font-weight: bold;">ğŸ­ ãƒãƒ¼ã‚ºã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„</div>
                    </div>
                    
                    <!-- å€‹åˆ¥è¨­å®šã‚¨ãƒªã‚¢ -->
                    <div id="storyIndividualSettings" style="display: none; margin-top: 20px; max-height: 40vh; overflow-y: auto; padding: 20px; background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%); border-radius: 12px; border: 3px solid #fdcb6e; box-shadow: 0 4px 15px rgba(253, 203, 110, 0.3);">
                        <h4 style="margin: 0 0 15px 0; color: #2d3436; font-size: 18px;">ğŸ’ å€‹åˆ¥è¨­å®š: <span id="currentSceneName" style="color: #d63031;"></span></h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <label style="font-size: 13px; font-weight: bold; color: #2d3436; display: block; margin-bottom: 5px;">ğŸï¸ èƒŒæ™¯</label>
                                <select id="sceneBackgroundSelect" style="width: 100%; padding: 8px; font-size: 13px; border: 2px solid #dfe6e9; border-radius: 6px; background: white;">
                                    <option value="">å…±é€šè¨­å®šã‚’ä½¿ç”¨</option>
                                </select>
                            </div>
                            <div>
                                <label style="font-size: 13px; font-weight: bold; color: #2d3436; display: block; margin-bottom: 5px;">ğŸ˜Š è¡¨æƒ…</label>
                                <select id="sceneExpressionSelect" style="width: 100%; padding: 8px; font-size: 13px; border: 2px solid #dfe6e9; border-radius: 6px; background: white;">
                                    <option value="">é¸æŠ...</option>
                                </select>
                            </div>
                            <div>
                                <label style="font-size: 13px; font-weight: bold; color: #2d3436; display: block; margin-bottom: 5px;">ğŸ‘— æœè£…</label>
                                <select id="sceneClothingSelect" style="width: 100%; padding: 8px; font-size: 13px; border: 2px solid #dfe6e9; border-radius: 6px; background: white;">
                                    <option value="">å…±é€šè¨­å®šã‚’ä½¿ç”¨</option>
                                </select>
                            </div>
                            <div>
                                <label style="font-size: 13px; font-weight: bold; color: #2d3436; display: block; margin-bottom: 5px;">ğŸ‘” æœè£…çŠ¶æ…‹</label>
                                <select id="sceneClothingStateSelect" style="width: 100%; padding: 8px; font-size: 13px; border: 2px solid #dfe6e9; border-radius: 6px; background: white;">
                                    <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ï¼ˆä½“ã‚«ãƒ†ã‚´ãƒªã®ã€Œæœè£…çŠ¶æ…‹ã€ã‚°ãƒ«ãƒ¼ãƒ—ã‹ã‚‰å–å¾—ï¼‰ -->
                                </select>
                            </div>
                            <div id="sceneUnderwearArea" style="display: none;">
                                <label style="font-size: 13px; font-weight: bold; color: #2d3436; display: block; margin-bottom: 5px;">ğŸ‘™ ä¸‹ç€ã‚»ãƒƒãƒˆ</label>
                                <select id="sceneUnderwearSelect" style="width: 100%; padding: 8px; font-size: 13px; border: 2px solid #dfe6e9; border-radius: 6px; background: white;">
                                    <option value="">é¸æŠãªã—</option>
                                    <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ï¼ˆæœè£…ã‚«ãƒ†ã‚´ãƒªã®ã€Œä¸‹ç€ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰å–å¾—ï¼‰ -->
                                </select>
                            </div>
                            <div>
                                <label style="font-size: 13px; font-weight: bold; color: #2d3436; display: block; margin-bottom: 5px;">ğŸ‘¨ ç«¿å½¹ç”·æ€§</label>
                                <select id="sceneMaleCharacterSelect" style="width: 100%; padding: 8px; font-size: 13px; border: 2px solid #dfe6e9; border-radius: 6px; background: white;">
                                    <option value="">å…±é€šè¨­å®šã‚’ä½¿ç”¨</option>
                                    <option value="none">ãªã—ï¼ˆä¸€äººç”¨ï¼‰</option>
                                    <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ï¼ˆfaceã‚«ãƒ†ã‚´ãƒªã®ã€Œç”·æ€§ã€ã‚°ãƒ«ãƒ¼ãƒ—ã‹ã‚‰å–å¾—ï¼‰ -->
                                </select>
                            </div>
                            <div id="sceneMaleClothingStateArea" style="display: none;">
                                <label style="font-size: 13px; font-weight: bold; color: #2d3436; display: block; margin-bottom: 5px;">ğŸ‘” ç”·æ€§æœè£…çŠ¶æ…‹</label>
                                <select id="sceneMaleClothingStateSelect" style="width: 100%; padding: 8px; font-size: 13px; border: 2px solid #dfe6e9; border-radius: 6px; background: white;">
                                    <option value="">é€šå¸¸</option>
                                    <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ï¼ˆä½“ã‚«ãƒ†ã‚´ãƒªã®ã€Œæœè£…çŠ¶æ…‹ã€ã‚°ãƒ«ãƒ¼ãƒ—ã‹ã‚‰å–å¾—ï¼‰ -->
                                </select>
                            </div>
                            <div style="grid-column: 1 / -1;">
                                <label style="font-size: 13px; font-weight: bold; color: #2d3436; display: block; margin-bottom: 5px;">ğŸ“ ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ¡ãƒ¢ï¼ˆå‚è€ƒç”¨ï¼‰</label>
                                <textarea id="sceneStoryMemoInput" rows="3" style="width: 100%; padding: 8px; font-size: 13px; border: 2px solid #dfe6e9; border-radius: 6px; background: white; resize: vertical; font-family: inherit;" placeholder="ã“ã®ã‚·ãƒ¼ãƒ³ã®ã‚¹ãƒˆãƒ¼ãƒªãƒ¼å±•é–‹ã®ãƒ¡ãƒ¢ï¼ˆå‚è€ƒç”¨ï¼‰"></textarea>
                            </div>
                        </div>
                        <!-- è¤‡æ•°äººå¥³æ€§ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã®å€‹åˆ¥è¨­å®š -->
                        <div id="sceneMultiGirlSettingsArea" style="display: none; margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.7); border-radius: 10px; border: 2px solid #fdcb6e;">
                            <h5 style="margin: 0 0 15px 0; color: #2d3436; font-size: 16px; font-weight: bold;">ğŸ‘¥ å„å¥³æ€§ã®å€‹åˆ¥è¨­å®šï¼ˆã“ã®ã‚·ãƒ¼ãƒ³å°‚ç”¨ï¼‰</h5>
                            <div id="sceneMultiGirlSettingsContainer"></div>
                        </div>
                    </div>
                </div>
                
                <!-- å³å´ï¼šã‚·ãƒ¼ãƒ³ä¸€è¦§ã¨ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
                <div style="width: 420px; flex-shrink: 0; display: flex; flex-direction: column; overflow: hidden; background: rgba(255,255,255,0.95); border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 3px solid #e74c3c;">
                        <h3 style="margin: 0; color: #e74c3c; font-size: 20px;">ğŸ“‹ é¸æŠä¸­ã®ã‚·ãƒ¼ãƒ³</h3>
                        <div style="display: flex; gap: 8px;">
                            <button onclick="saveStoryToFavorites()" style="padding: 8px 14px; background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 13px; font-weight: bold; box-shadow: 0 3px 10px rgba(255, 193, 7, 0.3); transition: all 0.3s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 5px 15px rgba(255, 193, 7, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 3px 10px rgba(255, 193, 7, 0.3)'" title="ãŠæ°—ã«å…¥ã‚Šã«ä¿å­˜">â­ ä¿å­˜</button>
                            <button onclick="loadStoryFromFavorites()" style="padding: 8px 14px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 13px; font-weight: bold; box-shadow: 0 3px 10px rgba(23, 162, 184, 0.3); transition: all 0.3s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 5px 15px rgba(23, 162, 184, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 3px 10px rgba(23, 162, 184, 0.3)'" title="ãŠæ°—ã«å…¥ã‚Šã‹ã‚‰èª­ã¿è¾¼ã¿">ğŸ“ èª­è¾¼</button>
                        </div>
                    </div>
                    <div style="margin-bottom: 10px; display: flex; gap: 8px; flex-wrap: wrap;">
                        <button onclick="showAIStoryGenerator()" style="flex: 1; min-width: 120px; padding: 10px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: bold; box-shadow: 0 3px 10px rgba(245, 87, 108, 0.3); transition: all 0.3s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 5px 15px rgba(245, 87, 108, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 3px 10px rgba(245, 87, 108, 0.3)'" title="AIã§ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’è‡ªå‹•ç”Ÿæˆ">ğŸ¤– AIç”Ÿæˆ</button>
                        <button onclick="showSNSPostGenerator()" style="flex: 1; min-width: 120px; padding: 10px; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: bold; box-shadow: 0 3px 10px rgba(79, 172, 254, 0.3); transition: all 0.3s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 5px 15px rgba(79, 172, 254, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 3px 10px rgba(79, 172, 254, 0.3)'" title="SNSæŠ•ç¨¿ç”¨ã®å˜ç™ºã‚¤ãƒ©ã‚¹ãƒˆã‚’AIç”Ÿæˆ">ğŸ“± SNSæŠ•ç¨¿ç”¨</button>
                        <button onclick="addSceneDivider()" style="flex: 1; min-width: 120px; padding: 10px; background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: bold; box-shadow: 0 3px 10px rgba(108, 92, 231, 0.3); transition: all 0.3s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 5px 15px rgba(108, 92, 231, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 3px 10px rgba(108, 92, 231, 0.3)'" title="ç›®æ¬¡çš„ãªåŒºåˆ‡ã‚Šã‚’è¿½åŠ ">ğŸ“Œ åŒºåˆ‡ã‚Šã‚’è¿½åŠ </button>
                    </div>
                    <div id="storyScenesListArea" style="flex: 1; overflow-y: auto; background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: inset 0 2px 10px rgba(0,0,0,0.05);">
                        <div style="text-align: center; color: #666; padding: 40px; font-size: 16px; font-weight: bold;">ğŸ¬ ãƒãƒ¼ã‚ºã‚’é¸æŠã—ã¦ãã ã•ã„</div>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding-bottom: 10px; border-bottom: 3px solid #27ae60;">
                        <h3 style="margin: 0; color: #27ae60; font-size: 20px;">ğŸ“„ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h3>
                        <button onclick="copyStoryPromptToClipboard()" style="padding: 8px 14px; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 13px; font-weight: bold; box-shadow: 0 3px 10px rgba(40, 167, 69, 0.3); transition: all 0.3s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 5px 15px rgba(40, 167, 69, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 3px 10px rgba(40, 167, 69, 0.3)'" title="ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
                    </div>
                    <textarea id="storyPreview" readonly style="flex: 1; font-family: 'Consolas', 'Monaco', monospace; padding: 15px; border: 2px solid #dfe6e9; border-radius: 8px; resize: none; background: #2d3436; color: #00ff00; font-size: 13px; line-height: 1.6;"></textarea>
                </div>
            </div>
        </div>
    </div>
    
    <!-- YAMLç”Ÿæˆãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="yamlGeneratorModal" class="yaml-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 10000; align-items: center; justify-content: center;">
        <div class="yaml-modal-content" style="width: 95%; height: 95vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 16px; position: relative; display: flex; flex-direction: column; box-shadow: 0 20px 60px rgba(0,0,0,0.5);">
            <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
            <div class="yaml-modal-header">
                <h2>ğŸ“„ YAMLç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ  v1.0</h2>
                <button class="yaml-close-btn" onclick="closeYAMLGenerator()">Ã—</button>
            </div>
            
            <!-- ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ -->
            <div class="yaml-mode-switch">
                <button id="yamlModeBtn" class="yaml-mode-btn active" onclick="switchYAMLMode('yaml')">ğŸ“„ YAMLç”Ÿæˆ</button>
                <button id="extractModeBtn" class="yaml-mode-btn" onclick="switchYAMLMode('extract')">ğŸ“‹ ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º</button>
            </div>
            
            <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
            <div class="yaml-modal-body">
                <!-- å·¦å´: ã‚«ãƒ†ã‚´ãƒªã‚¿ãƒ–ãƒ»è¨­å®šãƒ‘ãƒãƒ« -->
                <div class="yaml-left-panel">
                    <!-- YAMLç”Ÿæˆãƒ¢ãƒ¼ãƒ‰ -->
                    <div id="yamlModePanel" class="yaml-mode-panel">
                        <h3>ğŸŒ è¨­å®š</h3>
                        <button class="yaml-action-btn" onclick="YAMLGeneratorSystem.selectAndClassifyFile()">ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ</button>
                        <div class="yaml-stats-section">
                            <h4>ğŸ“Š çµ±è¨ˆ</h4>
                            <div id="yamlFileStats" class="yaml-stats">
                                <div>ç·è¡Œæ•°: <strong>0</strong></div>
                                <div>åˆ†é¡æ¸ˆã¿: <strong>0</strong></div>
                            </div>
                        </div>
                        <div class="yaml-category-tabs-section">
                            <h4>ğŸ“‘ ã‚«ãƒ†ã‚´ãƒª</h4>
                            <div id="yamlCategoryTabs" class="yaml-category-tabs"></div>
                        </div>
                        <div id="yamlGroupSectionFilter" class="yaml-group-section-filter" style="display: none; margin-top: 15px;">
                            <h4>ğŸ” ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</h4>
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-size: 13px; color: #2d3436;">ã‚°ãƒ«ãƒ¼ãƒ—:</label>
                                    <select id="yamlGroupSelect" class="yaml-filter-select" onchange="YAMLGeneratorSystem.onGroupChange()">
                                        <option value="">å…¨ã¦ã®ã‚°ãƒ«ãƒ¼ãƒ—</option>
                                    </select>
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-size: 13px; color: #2d3436;">ã‚»ãƒƒã‚·ãƒ§ãƒ³:</label>
                                    <select id="yamlSectionSelect" class="yaml-filter-select" onchange="YAMLGeneratorSystem.onSectionChange()">
                                        <option value="">å…¨ã¦ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡ºãƒ¢ãƒ¼ãƒ‰ -->
                    <div id="extractModePanel" class="yaml-mode-panel" style="display: none;">
                        <h3>ğŸŒ è¨­å®š</h3>
                        <button class="yaml-action-btn" onclick="selectExtractFolder()">ğŸ“ ãƒ•ã‚©ãƒ«ãƒ€é¸æŠ</button>
                        <div class="yaml-stats-section">
                            <h4>ğŸ“Š çµ±è¨ˆ</h4>
                            <div id="extractFileStats" class="yaml-stats">
                                <div>ãƒ•ã‚¡ã‚¤ãƒ«æ•°: <strong>0</strong></div>
                                <div>ç·è¡Œæ•°: <strong>0</strong></div>
                            </div>
                        </div>
                        <div class="yaml-category-checkboxes">
                            <h4>æŠ½å‡ºã‚«ãƒ†ã‚´ãƒªé¸æŠ</h4>
                            <label><input type="checkbox" value="characterface" onchange="toggleExtractCategory('characterface')"> ğŸ˜Š é¡”</label>
                            <label><input type="checkbox" value="clothing" onchange="toggleExtractCategory('clothing')"> ğŸ‘— æœè£…</label>
                            <label><input type="checkbox" value="poseemotion" onchange="toggleExtractCategory('poseemotion')"> ğŸ¤¸ ãƒãƒ¼ã‚º</label>
                            <label><input type="checkbox" value="backgrounds" onchange="toggleExtractCategory('backgrounds')"> ğŸï¸ èƒŒæ™¯</label>
                            <label><input type="checkbox" value="characterbody" onchange="toggleExtractCategory('characterbody')"> ğŸ’ƒ ä½“</label>
                            <label><input type="checkbox" value="uncategorized" onchange="toggleExtractCategory('uncategorized')"> ğŸ“¦ ãã®ä»–</label>
                            <label><input type="checkbox" onchange="toggleAllExtractCategories()"> â˜‘ å…¨ã¦é¸æŠ</label>
                        </div>
                    </div>
                </div>
                
                <!-- ä¸­å¤®: ã‚«ãƒ¼ãƒ‰ã‚°ãƒªãƒƒãƒ‰ -->
                <div class="yaml-center-panel">
                    <div id="yamlCardsArea" class="yaml-cards-grid">
                        <div style="grid-column: 1/-1; text-align: center; color: #999; padding: 60px; font-size: 18px; font-weight: bold;">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦åˆ†é¡ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„</div>
                    </div>
                </div>
                
                <!-- å³å´: é¸æŠçµæœãƒ»ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»å‡ºåŠ›ãƒ‘ãƒãƒ« -->
                <div class="yaml-right-panel">
                    <h3>ğŸ“‹ çµæœ</h3>
                    <div id="yamlStatistics" class="yaml-statistics"></div>
                    <div class="yaml-selection-buttons" style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <button class="yaml-action-btn" onclick="YAMLGeneratorSystem.selectAllCards()" style="flex: 1;">âœ… å…¨é¸æŠ</button>
                        <button class="yaml-action-btn" onclick="YAMLGeneratorSystem.deselectAllCards()" style="flex: 1;">âŒ å…¨è§£é™¤</button>
                    </div>
                    <div class="yaml-favorite-buttons">
                        <button class="yaml-favorite-btn" onclick="saveYAMLToFavorites()">â­ ä¿å­˜</button>
                        <button class="yaml-favorite-btn" onclick="loadYAMLFromFavorites()">ğŸ“ èª­è¾¼</button>
                    </div>
                    <div id="yamlOutputButtons" class="yaml-output-buttons">
                        <button class="yaml-output-btn" onclick="YAMLGeneratorSystem.generateAndSaveYAML()">ğŸ“„ YAMLç”Ÿæˆ</button>
                        <button class="yaml-output-btn" onclick="YAMLGeneratorSystem.copyYAMLToClipboard()">ğŸ“‹ ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰</button>
                    </div>
                    <div id="extractOutputButtons" class="yaml-output-buttons" style="display: none;">
                        <button class="yaml-output-btn" onclick="extractAndShowText()">ğŸ“‹ ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º</button>
                        <button class="yaml-output-btn" onclick="copyExtractedText()">ğŸ“‹ ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰</button>
                    </div>
                    <div id="yamlPreviewSection" class="yaml-preview-section">
                        <h4>ğŸ“„ YAMLãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h4>
                        <textarea id="yamlPreview" class="yaml-preview" readonly></textarea>
                    </div>
                    <div id="extractPreviewSection" class="yaml-preview-section" style="display: none; flex: 1; flex-direction: column; min-height: 400px; max-height: 500px;">
                        <h4>ğŸ“‹ æŠ½å‡ºçµæœãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h4>
                        <textarea id="extractPreview" class="yaml-preview" readonly style="flex: 1; width: 100%; min-height: 400px; max-height: 500px; overflow-y: auto;"></textarea>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>

